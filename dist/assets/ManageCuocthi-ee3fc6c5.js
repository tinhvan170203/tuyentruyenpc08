import{r as g,j as e,S as Z,s as ee,I as T,c as B,a as $,b as q,u as j,af as V,o as I,F as E,d as n,D as te,e as ae,f as ne,g as ie,h as le,B as A,L as re,G as S,i as N,k as oe,l as _,m as F,p as se,n as W,a5 as L,ag as _e,ah as we,ai as ze,v as R,w as C,y as Pe,z as Oe,aj as Me,a6 as M,T as $e,a7 as qe,q as Ve,t as Le,x as Ee,a8 as Re,a9 as Be,aa as G,ab as Q,ac as X,ad as J,C as je,A as Ie,$ as Ae,a3 as Fe,a4 as We,ae as Ke,E as Ye,H as D}from"./index-47bea717.js";import{d as He,a as Ue}from"./Backspace-abc3b6d9.js";import{q as Ge}from"./base-312a79a2.js";import{d as Qe}from"./Dashboard-bc6ebfe8.js";import{D as ce}from"./index-d5b927e4.js";import{d as Xe,a as Je}from"./Settings-7d61738f.js";const Ze=g.forwardRef(function(c,s){return e(Z,{direction:"up",ref:s,...c})}),et=ee(T)({position:"absolute",right:"16px",top:"4px"}),tt=B({tencuocthi:$().required("Lỗi: Vui lòng nhập tên cuộc thi"),soluongcauhoi:q().required("Lỗi: Vui lòng chọn số lượng câu hỏi"),thoigianthi:q().required("Lỗi: Vui lòng chọn thời gian thi"),ngaytochucthi:$().required("Lỗi: Vui lòng chọn ngày tổ chức thi")}).required();function at({open:o,onCloseDialogAddCauhoi:c,onSubmit:s,chuyendeList:u}){const i=j({defaultValues:{tencuocthi:"",password:"",thoigianthi:90,soluongcauhoi:50,ngaytochucthi:V(Date.now())},resolver:I(tt)}),t=async r=>{let p=[...h];p=h.map(d=>({...d,soluongcauhoi:d.soluongcauhoi===""?0:d.soluongcauhoi}));let a={...r,config:p};s&&(await s(a),y([]),i.reset(),c())};let[h,y]=g.useState([]);g.useEffect(()=>{y(u.map(r=>({chuyende:r.value,title:r.label,soluongcauhoi:0})))},[u]);const{isSubmitting:x}=i.formState,f=(r,p)=>{let a=[...h];a=a.map(d=>d.chuyende===r?{...d,soluongcauhoi:p.target.value}:{...d}),y(a)};return e(E,{children:n(te,{maxWidth:"lg",fullWidth:!0,disableEscapeKeyDown:!0,onClose:(r,p)=>{p!=="backdropClick"&&c(r,p)},open:o,TransitionComponent:Ze,keepMounted:!0,"aria-describedby":"alert-dialog-slide-description",children:[n(ae,{style:{display:"flex",borderBottom:"1px solid #ccc",margin:"0 12px"},children:[e(ne,{style:{color:"#333",fontSize:"32px"}}),e("span",{children:"Thêm mới cuộc thi trắc nghiệm"}),e(et,{onClick:()=>c(),children:e(ie,{style:{color:"#d32b2b"}})})]}),e(le,{children:n(A,{children:[x?e(re,{}):"",n("form",{onSubmit:i.handleSubmit(t),style:{width:"100%"},children:[n(S,{container:!0,spacing:1,style:{alignItems:"center",justifyContent:"center"},children:[e(S,{item:!0,xs:12,md:12,lg:12,children:e(N,{name:"tencuocthi",form:i,label:"Tên cuộc thi trắc nghiệm *",type:"text",disabled:!1})}),e(S,{item:!0,xs:3,md:3,lg:3,children:e(N,{name:"soluongcauhoi",form:i,label:"Số lượng câu hỏi thi *",type:"number",disabled:!1})}),e(S,{item:!0,xs:3,md:3,lg:3,children:e(N,{name:"thoigianthi",form:i,label:"Thời gian làm bài thi tính bằng phút *",type:"number",disabled:!1})}),e(S,{item:!0,xs:3,md:3,lg:3,children:e(ce,{name:"ngaytochucthi",form:i,label:"Ngày tổ chức cuộc thi *",disabled:!1})})]}),e("p",{className:"font-semibold mt-4",children:"Cấu hình số câu hỏi từng chuyên đề"}),e("div",{className:"border-t mt-4",children:h.map(r=>n("div",{className:"flex items-start justify-between",children:[e("p",{className:"text-gray-500 text-sm",children:r.title}),e("input",{className:"outline-none p-2",value:r.soluongcauhoi,onChange:p=>f(r.chuyende,p),placeholder:"Số lượng câu hỏi",type:"number",min:0})]}))}),e(oe,{children:n(_,{color:"primary",variant:"contained",disabled:x,type:"submit",style:{margin:"4px auto"},children:[e(F,{}),e("span",{children:"Thêm mới cuộc thi"})]})})]})]})})]})})}const nt=({onClose:o,row:c,onHandleChangeStatusCuocthi:s})=>{const u=se(),i=async()=>{await s(c._id),o()},t=W(h=>h.authReducer.roles_x01);return n(E,{children:[e("hr",{}),e(L,{onClick:()=>u(`/admin/ket-qua-thi/cuoc-thi/${c._id}`),children:n("div",{className:"flex items-center justify-between space-x-4 hover:bg-slate-200 p-1 rounded-md w-full",children:[e(Xe,{color:"primary"}),e("span",{className:"text-sm",children:"Kết quả thi"})]})}),t&&t.includes("sửa trạng thái cuộc thi")&&e(L,{onClick:()=>i(),children:n("div",{className:"flex items-center justify-between space-x-4 hover:bg-slate-200 p-1 rounded-md w-full",children:[e(Je,{color:"primary"}),e("span",{className:"text-sm",children:"Thay đổi trạng thái thi"})]})})]})};var K={},it=we;Object.defineProperty(K,"__esModule",{value:!0});var he=K.default=void 0,lt=it(_e()),rt=ze,ot=(0,lt.default)((0,rt.jsx)("path",{d:"M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"}),"MoreVertOutlined");he=K.default=ot;const st=({row:o,onClickOpenDialogEdit:c,onClickOpenDialogDelete:s,onHandleChangeStatusCuocthi:u})=>{const[i,t]=g.useState(null),h=Boolean(i),y=r=>{t(r.currentTarget)},x=()=>{t(null)},f=W(r=>r.authReducer.roles_x01);return n(R,{children:[e(C,{className:"border-r border-slate-300",align:"left",style:{fontWeight:"bold"},children:o.tencuocthi}),n(C,{className:"border-r border-slate-300",align:"left",children:[o.soluongcauhoi," (câu)"]}),n(C,{className:"border-r border-slate-300",align:"left",children:[o.thoigianthi," (phút)"]}),e(C,{className:"border-r border-slate-300",align:"left",style:{fontWeight:"bold"},children:V(o.ngaytochucthi).format("DD/MM/YYYY")}),e(C,{className:"border-r border-slate-300",align:"left",children:o.password}),e(C,{className:"border-r border-slate-300",align:"left",style:{color:"red"},children:o.status===!0?e("span",{className:"text-green-600 font-bold",children:"Đang diễn ra"}):"Không diễn ra"}),n(C,{align:"right",className:"bg-gray-300 flex justify-center items-center space-x-1",style:{width:"250px"},children:[f&&f.includes("sửa cuộc thi")&&e(_,{variant:"contained",color:"success",size:"small",onClick:()=>c(o),children:e(Pe,{style:{fontSize:"20px"}})}),f&&f.includes("xóa cuộc thi")&&e(_,{variant:"contained",color:"error",size:"small",style:{marginLeft:"4px"},onClick:()=>s(o._id),children:e(Oe,{style:{fontSize:"20px"}})}),e(T,{id:"basic-button","aria-controls":h?"basic-menu":void 0,"aria-haspopup":"true","aria-expanded":h?"true":void 0,onClick:y,children:e(he,{})}),e(Me,{id:"basic-menu",anchorEl:i,anchorOrigin:{vertical:"top",horizontal:"center"},transformOrigin:{vertical:"bottom",horizontal:"right"},open:h,onClose:x,MenuListProps:{"aria-labelledby":"basic-button"},children:e(nt,{onClose:x,onHandleChangeStatusCuocthi:u,row:o})})]})]},o._id)};function de(o){const c=Be(),{count:s,page:u,rowsPerPage:i,onPageChange:t}=o,h=r=>{t(r,0)},y=r=>{t(r,u-1)},x=r=>{t(r,u+1)},f=r=>{t(r,Math.max(0,Math.ceil(s/i)-1))};return n(A,{sx:{flexShrink:0,ml:2.5},children:[e(T,{onClick:h,disabled:u===0,"aria-label":"first page",children:c.direction==="rtl"?e(G,{}):e(Q,{})}),e(T,{onClick:y,disabled:u===0,"aria-label":"previous page",children:c.direction==="rtl"?e(X,{}):e(J,{})}),e(T,{onClick:x,disabled:u>=Math.ceil(s/i)-1,"aria-label":"next page",children:c.direction==="rtl"?e(J,{}):e(X,{})}),e(T,{onClick:f,disabled:u>=Math.ceil(s/i)-1,"aria-label":"last page",children:c.direction==="rtl"?e(Q,{}):e(G,{})})]})}de.propTypes={count:M.number.isRequired,onPageChange:M.func.isRequired,page:M.number.isRequired,rowsPerPage:M.number.isRequired};function ct({list:o,onClickOpenDialogEdit:c,onClickOpenDialogDelete:s,onHandleChangeStatusCuocthi:u}){const[i,t]=g.useState(0),[h,y]=g.useState(10),x=i>0?Math.max(0,(1+i)*h-o.length):0,f=(p,a)=>{t(a)},r=p=>{y(parseInt(p.target.value,10)),t(0)};return n(E,{children:[e($e,{component:qe,children:n(Ve,{"aria-label":"custom pagination table",children:[e(Le,{children:n(R,{children:[e(C,{align:"left",style:{fontSize:"14px",color:"#fff",padding:"8px 8px",backgroundColor:"#1976d2"},children:"Tên cuộc thi"}),e(C,{align:"left",style:{fontSize:"14px",color:"#fff",padding:"8px 8px",backgroundColor:"#1976d2"},children:"Số lượng câu hỏi"}),e(C,{align:"left",style:{fontSize:"14px",color:"#fff",padding:"8px 8px",backgroundColor:"#1976d2"},children:"Thời gian làm bài thi"}),e(C,{align:"left",style:{fontSize:"14px",color:"#fff",padding:"8px 8px",backgroundColor:"#1976d2"},children:"Ngày tổ chức thi"}),e(C,{align:"left",style:{fontSize:"14px",color:"#fff",padding:"8px 8px",backgroundColor:"#1976d2"},children:"Số điểm của cuộc thi"}),e(C,{align:"left",style:{fontSize:"14px",color:"#fff",padding:"8px 8px",backgroundColor:"#1976d2"},children:"Trạng thái"}),e(C,{align:"center",style:{fontSize:"14px",color:"#fff",padding:"8px 8px",backgroundColor:"#1976d2",maxWidth:"150px"},children:"Thao tác"})]})}),n(Ee,{children:[(h>0?o.slice(i*h,i*h+h):o).map(p=>e(st,{row:p,onClickOpenDialogEdit:c,onClickOpenDialogDelete:s,onHandleChangeStatusCuocthi:u},p._id)),x>0&&e(R,{style:{height:53*x},children:e(C,{colSpan:6})})]})]})}),e("div",{children:e(Re,{rowsPerPageOptions:[10,25,50,100,{label:"Tất cả",value:-1}],count:o.length,rowsPerPage:h,page:i,SelectProps:{inputProps:{"aria-label":"rows per page"},native:!0},component:"div",onPageChange:f,onRowsPerPageChange:r,ActionsComponent:de,labelRowsPerPage:"Số bản ghi hiển thị trên mỗi trang",labelDisplayedRows:function({from:a,to:d,count:b}){return`hiển thị ${a} đến ${d} bản ghi trong tổng số ${b!==-1?b:`more than ${d}`} bản ghi`}})})]})}const ht=g.forwardRef(function(c,s){return e(Z,{direction:"up",ref:s,...c})}),dt=ee(T)({position:"absolute",right:"16px",top:"4px"}),ut=B({tencuocthi:$().required("Lỗi: Vui lòng nhập tên cuộc thi"),soluongcauhoi:q().required("Lỗi: Vui lòng chọn số lượng câu hỏi"),thoigianthi:q().required("Lỗi: Vui lòng chọn thời gian thi"),ngaytochucthi:$().required("Lỗi: Vui lòng chọn ngày tổ chức thi")}).required();function gt({open:o,onCloseDialogEdit:c,item:s,onSubmit:u,chuyendeList:i}){const t=j({defaultValues:{tencuocthi:"",password:"",thoigianthi:90,soluongcauhoi:50,ngaytochucthi:V(Date.now())},resolver:I(ut)}),h=t.setValue;g.useEffect(()=>{s&&(h("tencuocthi",s.tencuocthi,{shouldValidate:!0}),h("thoigianthi",s.thoigianthi),h("ngaytochucthi",V(s.ngaytochucthi)),h("soluongcauhoi",s.soluongcauhoi))},[s]);let[y,x]=g.useState([]);g.useState([]),g.useState([]),g.useEffect(()=>{s&&x(i.map(a=>{let d=s.config.find(b=>b.chuyende.toString()==a.value);return d?{chuyende:a.value,title:a.label,soluongcauhoi:d.soluongcauhoi}:{chuyende:a.value,title:a.label,soluongcauhoi:0}}))},[i,s]);const f=async a=>{let d=[...y];if(d=y.map(b=>({...b,soluongcauhoi:b.soluongcauhoi===""?0:b.soluongcauhoi})),u){const b={...a,id_edit:s._id,config:d};await u(b),c()}},{isSubmitting:r}=t.formState,p=(a,d)=>{let b=[...y];b=b.map(w=>w.chuyende===a?{...w,soluongcauhoi:d.target.value}:{...w}),x(b)};return e(E,{children:n(te,{maxWidth:"lg",fullWidth:!0,disableEscapeKeyDown:!0,onClose:(a,d)=>{d!=="backdropClick"&&c(a,d)},open:o,TransitionComponent:ht,keepMounted:!0,"aria-describedby":"alert-dialog-slide-description",children:[n(ae,{style:{display:"flex",borderBottom:"1px solid #ccc",margin:"0 12px"},children:[e(ne,{style:{color:"#333",fontSize:"32px"}}),e("span",{children:"Chỉnh sửa thông số cuộc thi trắc nghiệm"}),e(dt,{onClick:()=>c(),children:e(ie,{style:{color:"#d32b2b"}})})]}),e(le,{children:n(A,{children:[r?e(re,{}):"",n("form",{onSubmit:t.handleSubmit(f),style:{width:"100%"},children:[n(S,{container:!0,spacing:1,style:{alignItems:"center",justifyContent:"center"},children:[e(S,{item:!0,xs:12,md:12,lg:12,children:e(N,{name:"tencuocthi",form:t,label:"Tên cuộc thi trắc nghiệm *",type:"text",disabled:!1})}),e(S,{item:!0,xs:3,md:3,lg:3,children:e(N,{name:"soluongcauhoi",form:t,label:"Số lượng câu hỏi thi *",type:"number",disabled:!1})}),e(S,{item:!0,xs:3,md:3,lg:3,children:e(N,{name:"thoigianthi",form:t,label:"Thời gian làm bài thi tính bằng phút *",type:"number",disabled:!1})}),e(S,{item:!0,xs:3,md:3,lg:3,children:e(ce,{name:"ngaytochucthi",form:t,label:"Ngày tổ chức cuộc thi *",disabled:!1})})]}),e("p",{className:"font-semibold mt-4",children:"Cấu hình số câu hỏi từng chuyên đề"}),e("div",{className:"border-t mt-4",children:y.map(a=>n("div",{className:"flex items-start justify-between",children:[e("p",{className:"text-gray-500 text-sm",children:a.title}),e("input",{className:"outline-none p-2",value:a.soluongcauhoi,onChange:d=>p(a.chuyende,d),placeholder:"Số lượng câu hỏi",type:"number",min:0})]}))}),e(oe,{children:n(_,{color:"primary",variant:"contained",disabled:r,type:"submit",style:{margin:"4px auto"},children:[e(F,{}),e("span",{children:"Cập nhật"})]})})]})]})})]})})}const mt=B({}).required(),Ct=()=>{const o=j({defaultValues:{tencuocthi:""},resolver:I(mt)}),c=W(l=>l.authReducer.roles_x01),[s,u]=g.useState([]),i=se(),{enqueueSnackbar:t}=je();let[h,y]=Ie();const[x,f]=g.useState(!1),[r,p]=g.useState([]),[a,d]=g.useState(null),[b,w]=g.useState([]),[P,Y]=g.useState({status:!1,item:null}),ue=l=>{Y({item:l,status:!0})},ge=()=>{Y({...P,status:!1})},[z,O]=g.useState({status:!1,id_Delete:null}),me=l=>{O({status:!0,id_Delete:l})},pe=()=>{O({...z,status:!1})},fe=()=>{O({...z,status:!1})},k=g.useMemo(()=>{const l=Ge.parse(location.search);return{...l,tencuocthi:l.tencuocthi||""}},[location.search]);g.useEffect(()=>{(async()=>{try{let m=await D.getMonthiOfUser();p(m.data.quantrinhommonthi)}catch(m){m.message==="Token không hợp lệ hoặc đã hết hạn. Vui lòng đăng nhập lại"&&(i("/login"),t(m.message,{anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"error"})),t(m.message,{anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"error"})}})()},[]),g.useEffect(()=>{a&&(async()=>{try{f(!0);let m=await D.getCuocthis({...k,id_monthi:a}),v=await D.getChuyendes({id_monthi:a});w(v.data.map(U=>({label:U.title,value:U._id}))),u(m.data),f(!1)}catch(m){m.message==="Token không hợp lệ hoặc đã hết hạn. Vui lòng đăng nhập lại"&&(i("/login"),t(m.message,{anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"error"})),t(m.message,{anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"error"})}})()},[a,k]);const be=async l=>{y({...k,...l})},ye=()=>{o.reset()},[xe,H]=g.useState(!1),ve=()=>{H(!1)},Ce=()=>{H(!0)},Se=l=>{d(l.target.value)},ke=async l=>{if(!a){t("Vui lòng chọn môn thi trắc nghiệm",{anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"error"});return}try{let m={...l,queryParams:k},v=await D.addCuocthi(a,m);u(v.data.items),t("Thêm mới thành công!",{anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"success"})}catch(m){m.message==="Token không hợp lệ hoặc đã hết hạn. Vui lòng đăng nhập lại"&&(i("/login"),t(m.message,{anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"error"})),t(m.message,{anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"error"}),f(!1),i("/login")}},De=async()=>{try{let l=await D.deleteCuocthi(z.id_Delete,{...k,id_monthi:a});u(l.data.items),O({...z,status:!1}),t(l.data.message,{anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"success"})}catch(l){l.message==="Token không hợp lệ hoặc đã hết hạn. Vui lòng đăng nhập lại"&&(i("/login"),t(l.message,{anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"error"})),t(l.message,{anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"error"})}},Te=async l=>{let m={...k,id_monthi:a,id_cuocthi:l};try{let v=await D.editStatusCuocthi(m);u(v.data),t("Thay đổi trạng thái cuộc thi thành công!",{anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"success"})}catch(v){v.message==="Token không hợp lệ hoặc đã hết hạn. Vui lòng đăng nhập lại"&&(i("/login"),t(v.message,{anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"error"})),t(v.message,{anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"error"}),f(!1)}},Ne=async l=>{let m={...l,queryParams:{...k},id_cuocthi:l.id_edit,id_monthi:a};try{let v=await D.updateOptionCuocthi(m);u(v.data.items),t(v.data.message,{anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"success"})}catch(v){v.message==="Token không hợp lệ hoặc đã hết hạn. Vui lòng đăng nhập lại"&&(i("/login"),t(v.message,{anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"error"})),t(v.message,{anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"error"}),f(!1)}};return n("div",{className:"mx-2 bg-white pb-2 px-4 shadow-2xl py-2",children:[n("h3",{className:"flex items-center space-x-2",children:[e(Qe,{}),e("span",{className:"text-lg font-semibold",children:"Quản lý cuộc thi trắc nghiệm"})]}),n("div",{className:"py-4 ml-4 mt-2",children:[e("div",{className:"my-2 mb-4",children:n(Ae,{fullWidth:!0,children:[e(Fe,{id:"demo-simple-select-label",children:"Môn thi trắc ngiệm"}),n(We,{labelId:"demo-simple-select-label",id:"demo-simple-select",label:"Môn thi trắc ngiệm",value:a!==null?a:" ",size:"small",onChange:Se,children:[e(L,{value:" ",disabled:!0,hidden:!0,children:"Vui lòng chọn môn thi"}),r.map(l=>e(L,{value:l._id,children:l.tenmonthi},l._id))]})]})}),e("form",{onSubmit:o.handleSubmit(be),className:"bg-gray-100 rounded-xl mt-8",children:n("fieldset",{style:{border:"1px solid #ccc",paddingBlockEnd:"12px"},children:[e("legend",{style:{paddingInline:"12px",fontWeight:"bold"},children:"Tra cứu cuộc thi:"}),e("div",{className:"flex p-4 flex-1 flex-wrap",children:e("div",{className:"px-1 w-full",children:e(N,{name:"tencuocthi",form:o,label:"Tên cuộc thi",type:"text",disabled:!1})})}),n("div",{className:"flex flex-col px-4 space-y-2 md:space-y-0 md:space-x-2 md:items-center md:justify-center md:flex-row",children:[n(_,{color:"primary",variant:"contained",type:"submit",children:[e(He,{}),e("span",{children:"Tìm kiếm cuộc thi"})]}),n(_,{variant:"contained",onClick:ye,color:"warning",children:[e("span",{className:"mr-2",children:"Xóa trắng"}),e(Ue,{})]})]})]})}),c&&c.includes("thêm cuộc thi")&&a&&e("div",{className:"text-end mb-4 mt-8",children:n(_,{variant:"contained",onClick:Ce,children:[e(F,{}),"Tạo mới cuộc thi"]})}),x&&e(Ke,{open:x})]}),e(ct,{list:s,item:P.item,onClickOpenDialogDelete:me,onClickOpenDialogEdit:ue,onHandleChangeStatusCuocthi:Te}),e(at,{open:xe,onCloseDialogAddCauhoi:ve,onSubmit:ke,chuyendeList:b}),e(gt,{open:P.status,item:P.item,onCloseDialogEdit:ge,onSubmit:Ne,chuyendeList:b}),e(Ye,{open:z.status,onCloseDialogDelete:pe,onConfirmDelete:De,onCancelDelete:fe})]})};export{Ct as default};
