import{r as h,d,v as R,j as e,w as n,L as F,l as N,T as Q,a7 as ee,q as W,t as j,x as A,n as B,B as te,y as ae,z as ne,aT as le,p as ie,A as se,aO as he,C as oe,aG as T,F as re,E as ce,aU as L,aY as de,aZ as ge}from"./index-a4aab209.js";import{S as me,P as ue}from"./PaginationComponent-e7c3afe8.js";import{q as pe}from"./base-312a79a2.js";function S({label:l,values:u,onChangeRoleList:o,userTemp:x}){const[m,r]=h.useState([]);h.useEffect(()=>{r(u)},[]),h.useEffect(()=>{if(x){let a=[];u.forEach(c=>{x.roles.includes(c.name)?a.push({name:c.name,isChecked:!0}):a.push({name:c.name,isChecked:!1})}),r(a)}else r(u)},[x]);const i=a=>{const{name:c,checked:v}=a.target;if(c==="allSelect"){let b=m.map(s=>({...s,isChecked:v}));r(b);let f=[],g=[];b.forEach(s=>{s.isChecked===!0?f.push(s.name):g.push(s.name)}),o(f,g)}else{let b=m.map(s=>s.name===c?{...s,isChecked:v}:s);r(b);let f=[],g=[];b.forEach(s=>{s.isChecked===!0?f.push(s.name):g.push(s.name)}),o(f,g)}};return d(R,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[e(n,{component:"th",scope:"row",children:e("span",{className:"font-bold",children:l})}),m&&m.map((a,c)=>e(n,{align:"right",children:e("input",{type:"checkbox",checked:(a==null?void 0:a.isChecked)||!1,name:a.name,onChange:i})},a.name)),e(n,{align:"right",children:e("input",{type:"checkbox",checked:m.filter(a=>(a==null?void 0:a.isChecked)!==!0).length<1,name:"allSelect",value:"allSelect",onChange:i})})]})}function fe({userTemp:l,onHandleEditUser:u}){let o=[];const[x,m]=h.useState([]),[r,i]=h.useState(!1);h.useEffect(()=>{m(l!==null?l.roles:[])},[l]);const a=async()=>{let v={id_edit:l._id,roles:x};i(!0),await u(v),i(!1),m([])},c=(v,b)=>{o=x,b.length>0&&b.forEach(f=>{let g=o.findIndex(s=>s===f);g!==-1&&o.splice(g,1)}),o=o.concat(v),o=Array.from(new Set(o)),m(o)};return d("div",{className:"px-2 py-4",children:[r&&e(F,{}),d("h3",{className:"text-center text-black font-bold sm:text-[14px] md:text-[16px]",children:["Phân quyền cho tài khoản",e("span",{className:"ml-1",children:l&&l.tentaikhoan})]}),e("div",{className:"text-right mb-2",children:e(N,{variant:"contained",onClick:a,disabled:l===null||r,children:"Cập nhật"})}),e(Q,{component:ee,children:d(W,{children:[e(j,{children:d(R,{children:[e(n,{}),e(n,{align:"right",children:"Xem"}),e(n,{align:"right",children:"Thêm"}),e(n,{align:"right",children:"Sửa"}),e(n,{align:"right",children:"Xóa"}),e(n,{align:"right",children:"Full"})]})}),d(A,{children:[e(S,{label:"QL tài khoản",values:[{name:"xem tài khoản"},{name:"thêm tài khoản"},{name:"sửa tài khoản"},{name:"xóa tài khoản"}],onChangeRoleList:c,userTemp:l}),e(S,{label:"Phân quyền QL môn thi",values:[{name:"xem phân quyền quản lý môn thi"},{name:"thêm phân quyền quản lý môn thi"},{name:"sửa phân quyền quản lý môn thi"},{name:"xóa phân quyền quản lý môn thi"}],onChangeRoleList:c,userTemp:l}),e(S,{label:"QL môn thi",values:[{name:"xem môn thi"},{name:"thêm môn thi"},{name:"sửa môn thi"},{name:"xóa môn thi"}],onChangeRoleList:c,userTemp:l}),e(S,{label:"QL cuộc thi",values:[{name:"xem cuộc thi"},{name:"thêm cuộc thi"},{name:"sửa cuộc thi"},{name:"xóa cuộc thi"}],onChangeRoleList:c,userTemp:l}),e(S,{label:"QL câu hỏi",values:[{name:"xem câu hỏi"},{name:"thêm câu hỏi"},{name:"sửa câu hỏi"},{name:"xóa câu hỏi"}],onChangeRoleList:c,userTemp:l}),e(S,{label:"Thay đổi trạng thái cuộc thi",values:[{name:"xem trạng thái cuộc thi"},{name:"thêm trạng thái cuộc thi"},{name:"sửa trạng thái cuộc thi"},{name:"xóa trạng thái cuộc thi"}],onChangeRoleList:c,userTemp:l})]})]})})]})}const xe=({userList:l,userTemp:u,page:o,onClickOpenDialogDelete:x,onClickSettingRoleUser:m})=>{const r=B(i=>i.authReducer.roles_x01);return e(te,{mt:4,children:e(Q,{children:d(W,{sx:{minWidth:650},"aria-label":"simple table",children:[e(j,{children:d(R,{children:[e(n,{align:"left",style:{fontSize:"14px"},children:"#"}),e(n,{align:"left",style:{fontSize:"14px"},children:"Tên tài khoản"}),e(n,{align:"left",style:{fontSize:"14px"},children:"Mật khẩu"}),e(n,{align:"left",style:{fontSize:"14px"},children:"Thứ tự"}),e(n,{align:"left",style:{fontSize:"14px"},children:"Quyền hệ thống"}),e(n,{align:"right",style:{fontSize:"14px"},children:"Thao tác"})]})}),e(A,{children:l.map((i,a)=>d(R,{className:u&&i._id===u._id?"bg-gray-300":"",sx:{"&:last-child td, &:last-child th":{border:0}},children:[e(n,{component:"th",scope:"row",children:(o-1)*5+1+a}),e(n,{align:"left",style:{fontWeight:"bold"},children:i.tentaikhoan}),e(n,{align:"left",children:i.matkhau}),e(n,{align:"left",children:i.thutu}),e(n,{align:"left",children:i.roles.toString()}),d(n,{align:"right",style:{minWidth:"200px"},children:[r&&r.includes("sửa tài khoản")&&d(N,{variant:"contained",color:"success",onClick:()=>m(i),size:"small",children:[e(ae,{style:{fontSize:"20px",marginRight:"4px"}})," ","Phân quyền"]}),r&&r.includes("xóa tài khoản")&&d(N,{variant:"contained",color:"error",size:"small",style:{marginTop:"4px"},onClick:()=>x(i._id),disabled:u&&i._id===u._id,children:[e(ne,{style:{fontSize:"20px",marginRight:"4px"}})," ","Xóa"]})]})]},i._id))})]})})})},ke=xe;function Ce(){const[l,u]=h.useState(""),[o,x]=h.useState(""),[m,r]=h.useState(1),[i,a]=h.useState(!1),[c,v]=h.useState(!0),[b,f]=h.useState([]),[g,s]=h.useState({page:1,total:1}),[_,q]=h.useState(null),U=le(),C=ie();let[be,O]=se();const[w,z]=h.useState({status:!1,id_Delete:null});h.useState({status:!1,user:null});const I=he(),P=B(t=>t.authReducer.roles_x01),D=h.useMemo(()=>{const t=pe.parse(U.search);return{...t,page:Number(t.page)||1}},[U.search]),{enqueueSnackbar:k}=oe(),M=()=>{z({...w,status:!1})},V=t=>{z({status:!0,id_Delete:t})},X=t=>{s({...g,page:t});const p={...D,page:t};O(p)},H=async()=>{try{a(!0);let t=await L.addUser({tentaikhoan:l,matkhau:o,thutu:m});a(!1),k("Thêm mới tài khoản thành công!",{anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"success"}),u(""),x(""),r(1),f(t.data.users),s({page:1,total:t.data.total})}catch(t){t.message==="Token không hợp lệ vui lòng đăng nhập hoặc đã hết hạn. Vui lòng đăng nhập lại"&&(C("/login"),k(t.message,{anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"error"})),k(t.response.data.message,{anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"error"})}},$=async t=>{let p=g.page;const E={...t,page:p};try{let y=await L.editUser(E);const J=localStorage.getItem("accessToken_thitracnghiem"),K=de(J);E.id_edit===K.userId&&I(ge(t.roles)),f(y.data.users),q(null),k(y.data.message,{anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"success"})}catch(y){y.message==="Token không hợp lệ vui lòng đăng nhập hoặc đã hết hạn. Vui lòng đăng nhập lại"&&(C("/login"),k(y.message,{anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"error"})),k(y.message,{anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"error"})}},G=async()=>{try{let t=await L.deleteUser(w.id_Delete);f(t.data.users),s({...g,page:1,total:t.data.total});const p={...D,page:1};O(p),z({...w,status:!1}),k(t.data.message,{anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"success"})}catch(t){t.message==="Token không hợp lệ hoặc đã hết hạn. Vui lòng đăng nhập lại"&&(C("/login"),k(t.message,{anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"error"})),k(t.message,{anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"error"})}},Y=()=>{z({...w,status:!1})};h.useEffect(()=>{(async()=>{try{const p=await L.getUsers(D.page);f(p.data.users),s({page:Number(p.data.page),total:p.data.total}),v(!1)}catch(p){p.message==="Token không hợp lệ hoặc đã hết hạn. Vui lòng đăng nhập lại"?(k(p.message,{anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"error"}),C("/login")):(k(p.message,{anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"error"}),C("/login"))}})()},[D]);const Z=t=>{q(t)};return d("div",{className:"flex flex-col mx-2 space-x-1 lg:flex-row",children:[d("div",{className:"lg:basis-2/3 bg-white px-4",children:[e("h1",{className:"text-gray-900 text-center mt-2 pt-4 font-bold sm:text-[14px] md:text-[16px]",children:"Quản lý tài khoản người dùng"}),i&&e(F,{}),P&&P.includes("thêm tài khoản")&&d("form",{className:"flex flex-col items-center space-x-0 justify-start mt-8 flex-wrap md:flex-row md:space-x-4",children:[e("div",{className:"my-2 w-full md:w-[auto]",children:e(T,{name:"tentaikhoan",fullWidth:!0,label:"Tên tài khoản",value:l,onChange:t=>u(t.target.value),size:"small"})}),e("div",{className:"my-2 w-full md:w-[auto]",children:e(T,{name:"matkhau",fullWidth:!0,label:"Mật khẩu",value:o,onChange:t=>x(t.target.value),size:"small"})}),e("div",{className:"my-2 w-full md:w-[auto]",children:e(T,{name:"thutu",fullWidth:!0,label:"Thứ tự",value:m,onChange:t=>r(t.target.value),type:"number",size:"small"})}),e("div",{className:"my-2 w-full md:w-[auto] text-center",children:e(N,{onClick:H,variant:"contained",disabled:i,children:"Thêm mới"})})]}),c?e("div",{className:"mt-2",children:e(me,{variant:"rectangular",width:"100%",height:"450px"})}):d(re,{children:[e(ke,{userList:b,page:g.page,onClickOpenDialogDelete:V,onClickSettingRoleUser:Z,userTemp:_}),e(ue,{page:g.page,totalPage:g.total,onChangePage:X})]})]}),e("div",{className:"lg:basis-1/3 bg-white",children:e(fe,{userTemp:_,onHandleEditUser:$})}),e(ce,{open:w.status,onCloseDialogDelete:M,onConfirmDelete:G,onCancelDelete:Y})]})}export{Ce as default};
