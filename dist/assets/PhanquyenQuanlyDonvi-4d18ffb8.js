import{r as s,j as e,d as c,a7 as L,F as w,l as P,n as R,B as A,T as M,q as O,t as j,v as q,w as p,x as B,y as D,aT as F,p as Q,A as W,C as H,L as V,aU as N}from"./index-4131e7c8.js";import{q as I}from"./base-312a79a2.js";import{S as G,P as J}from"./PaginationComponent-59d5a58b.js";import{c as K}from"./commonApi-58646d90.js";function X({values:g,onHandleEdit:f,userTemp:o}){const[r,n]=s.useState([]),[l,x]=s.useState(!1);s.useEffect(()=>{n(g)},[g]),s.useEffect(()=>{if(o){let t=[];g.forEach(i=>{o.quantrinhomdonvi.map(h=>h._id).includes(i.name)?t.push({name:i.name,monthi:i.monthi,isChecked:!0}):t.push({name:i.name,monthi:i.monthi,isChecked:!1})}),n(t)}else n(g)},[o]);const b=t=>{const{name:i,checked:h}=t.target;if(i==="allSelect"){let y=r.map(u=>({...u,isChecked:h}));n(y)}else{let y=r.map(u=>u.name===i?{...u,isChecked:h}:u);n(y)}},v=async()=>{let t=[];r.forEach(h=>{h.isChecked===!0&&t.push(h.name)});let i={id_edit:o._id,quantrinhomdonvi:t};x(!0),await f(i),x(!1)};return e("div",{className:"p-2",children:c(L,{style:{padding:"16px"},children:[c("h3",{className:"text-md text-center mt-2 font-bold",children:["Nhóm môn thi được quản lý ",o&&c(w,{children:["bởi tài khoản ",o.tentaikhoan]})]}),e("div",{className:"text-end mt-2",children:e(P,{variant:"contained",size:"small",disabled:o===null||l,onClick:v,children:"Lưu phân quyền"})}),c("div",{children:[e("input",{type:"checkbox",checked:r.filter(t=>(t==null?void 0:t.isChecked)!==!0).length<1,name:"allSelect",value:"allSelect",onChange:b}),e("span",{className:"text-red-900 font-bold ml-1",children:"Tất cả"})]}),e("div",{className:"flex flex-col flex-wrap",children:r&&r.map((t,i)=>c("div",{className:"flex items-center space-x-1",children:[e("input",{type:"checkbox",checked:(t==null?void 0:t.isChecked)||!1,name:t.name,onChange:b}),e("span",{className:"text-black",children:t.monthi})]},t.name))})]})})}const Y=({userList:g,userTemp:f,page:o,onClickSettingRoleUser:r})=>{const n=R(l=>l.authReducer.roles_x01);return e(A,{mt:4,children:e(M,{children:c(O,{sx:{minWidth:650},"aria-label":"simple table",children:[e(j,{children:c(q,{children:[e(p,{align:"left",style:{fontSize:"14px"},children:"#"}),e(p,{align:"left",style:{fontSize:"14px"},children:"Tên tài khoản"}),e(p,{align:"left",style:{fontSize:"14px"},children:"Quyền quản lý môn thi"}),e(p,{align:"right",style:{fontSize:"14px"},children:"Thao tác"})]})}),e(B,{children:g.map((l,x)=>c(q,{className:f&&l._id===f._id?"bg-gray-300":"",sx:{"&:last-child td, &:last-child th":{border:0}},children:[e(p,{component:"th",scope:"row",children:(o-1)*5+1+x}),e(p,{align:"left",style:{fontWeight:"bold"},children:l.tentaikhoan}),e(p,{align:"left",children:l.quantrinhomdonvi.map(b=>b.tenmonthi).toString()}),e(p,{align:"right",style:{minWidth:"200px"},children:n&&n.includes("sửa phân quyền quản lý môn thi")&&c(P,{variant:"contained",color:"success",onClick:()=>r(l),size:"small",children:[e(D,{style:{fontSize:"20px",marginRight:"4px"}})," ","Phân quyền"]})})]},l._id))})]})})})},ae=()=>{const[g,f]=s.useState(!0),[o,r]=s.useState([]),[n,l]=s.useState({page:1,total:1}),[x,b]=s.useState(!1),[v,t]=s.useState(null),i=F(),h=Q();let[y,u]=W();const{enqueueSnackbar:S}=H(),k=s.useMemo(()=>{const d=I.parse(i.search);return{...d,page:Number(d.page)||1}},[i.search]),z=d=>{l({...n,page:d});const a={...k,page:d};u(a)},[E,T]=s.useState([]);s.useEffect(()=>{(async()=>{let a=await K.getAllMonthi();if(a&&a.data.length>0){let C=a.data.map(m=>({name:m._id,monthi:m.tenmonthi}));T(C)}})()},[]),s.useEffect(()=>{(async()=>{try{const a=await N.getUsers(k.page);console.log(a),r(a.data.users),l({page:Number(a.data.page),total:a.data.total}),f(!1)}catch(a){a.message==="Token không hợp lệ hoặc đã hết hạn. Vui lòng đăng nhập lại"?(S(a.message,{anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"error"}),h("/login")):(S(a.message,{anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"error"}),h("/login"))}})()},[k]);const U=d=>{t(d)},_=async d=>{let a=n.page;const C={...d,page:a};try{let m=await N.editQuanlydonvi(C);r(m.data.users),t(null),S(m.data.message,{anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"success"})}catch(m){m.message==="Token không hợp lệ hoặc đã hết hạn. Vui lòng đăng nhập lại"&&(h("/login"),S(m.message,{anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"error"})),S(m.message,{anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"error"})}};return c("div",{className:"flex flex-col mx-2 lg:space-x-1 lg:flex-row",children:[c("div",{className:"lg:basis-2/3 bg-white px-4",children:[e("h1",{className:"text-gray-900 text-center mt-2 pt-4 font-bold sm:text-[14px] md:text-[18px]",children:"Phân quyền quản lý môn thi"}),x&&e(V,{}),g?e("div",{className:"mt-2",children:e(G,{variant:"rectangular",width:"100%",height:"450px"})}):c(w,{children:[e(Y,{userList:o,page:n.page,onClickSettingRoleUser:U,userTemp:v}),e(J,{page:n.page,totalPage:n.total,onChangePage:z})]})]}),e("div",{className:"lg:basis-1/3 bg-white",children:e(X,{userTemp:v,onHandleEdit:_,values:E})})]})};export{ae as default};
