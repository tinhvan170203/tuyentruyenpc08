import{r as o,d,j as e,L as F,B as R,P as ee,f as Q,au as te,g as ae,h as ne,am as ie,i as le,ah as _,F as se,av as L,aA as oe,aB as he}from"./index-239067be.js";import{c as N,d as n,T as B,a as W,b as j,e as A,f as re}from"./Edit-09a4f9c2.js";import{d as ce,a as de}from"./DeleteOutline-46389fe2.js";import{B as ge}from"./Box-9ef30f59.js";import{S as me,P as ue}from"./PaginationComponent-285780d7.js";import{q as fe}from"./base-312a79a2.js";import"./Cancel-26ae82a6.js";function S({label:i,values:u,onChangeRoleList:h,userTemp:x}){const[m,r]=o.useState([]);o.useEffect(()=>{r(u)},[]),o.useEffect(()=>{if(x){let a=[];u.forEach(c=>{x.roles.includes(c.name)?a.push({name:c.name,isChecked:!0}):a.push({name:c.name,isChecked:!1})}),r(a)}else r(u)},[x]);const l=a=>{const{name:c,checked:v}=a.target;if(c==="allSelect"){let b=m.map(s=>({...s,isChecked:v}));r(b);let p=[],g=[];b.forEach(s=>{s.isChecked===!0?p.push(s.name):g.push(s.name)}),h(p,g)}else{let b=m.map(s=>s.name===c?{...s,isChecked:v}:s);r(b);let p=[],g=[];b.forEach(s=>{s.isChecked===!0?p.push(s.name):g.push(s.name)}),h(p,g)}};return d(N,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[e(n,{component:"th",scope:"row",children:e("span",{className:"font-bold",children:i})}),m&&m.map((a,c)=>e(n,{align:"right",children:e("input",{type:"checkbox",checked:(a==null?void 0:a.isChecked)||!1,name:a.name,onChange:l})},a.name)),e(n,{align:"right",children:e("input",{type:"checkbox",checked:m.filter(a=>(a==null?void 0:a.isChecked)!==!0).length<1,name:"allSelect",value:"allSelect",onChange:l})})]})}function pe({userTemp:i,onHandleEditUser:u}){let h=[];const[x,m]=o.useState([]),[r,l]=o.useState(!1);o.useEffect(()=>{m(i!==null?i.roles:[])},[i]);const a=async()=>{let v={id_edit:i._id,roles:x};l(!0),await u(v),l(!1),m([])},c=(v,b)=>{h=x,b.length>0&&b.forEach(p=>{let g=h.findIndex(s=>s===p);g!==-1&&h.splice(g,1)}),h=h.concat(v),h=Array.from(new Set(h)),m(h)};return d("div",{className:"px-2 py-4",children:[r&&e(F,{}),d("h3",{className:"text-center text-black font-bold sm:text-[14px] md:text-[16px]",children:["Phân quyền cho tài khoản",e("span",{className:"ml-1",children:i&&i.tentaikhoan})]}),e("div",{className:"text-right mb-2",children:e(R,{variant:"contained",onClick:a,disabled:i===null||r,children:"Cập nhật"})}),e(B,{component:ee,children:d(W,{children:[e(j,{children:d(N,{children:[e(n,{}),e(n,{align:"right",children:"Xem"}),e(n,{align:"right",children:"Thêm"}),e(n,{align:"right",children:"Sửa"}),e(n,{align:"right",children:"Xóa"}),e(n,{align:"right",children:"Full"})]})}),d(A,{children:[e(S,{label:"QL tài khoản",values:[{name:"xem tài khoản"},{name:"thêm tài khoản"},{name:"sửa tài khoản"},{name:"xóa tài khoản"}],onChangeRoleList:c,userTemp:i}),e(S,{label:"Phân quyền QL môn thi",values:[{name:"xem phân quyền quản lý môn thi"},{name:"thêm phân quyền quản lý môn thi"},{name:"sửa phân quyền quản lý môn thi"},{name:"xóa phân quyền quản lý môn thi"}],onChangeRoleList:c,userTemp:i}),e(S,{label:"QL môn thi",values:[{name:"xem môn thi"},{name:"thêm môn thi"},{name:"sửa môn thi"},{name:"xóa môn thi"}],onChangeRoleList:c,userTemp:i}),e(S,{label:"QL cuộc thi",values:[{name:"xem cuộc thi"},{name:"thêm cuộc thi"},{name:"sửa cuộc thi"},{name:"xóa cuộc thi"}],onChangeRoleList:c,userTemp:i}),e(S,{label:"QL câu hỏi",values:[{name:"xem câu hỏi"},{name:"thêm câu hỏi"},{name:"sửa câu hỏi"},{name:"xóa câu hỏi"}],onChangeRoleList:c,userTemp:i}),e(S,{label:"Thay đổi trạng thái cuộc thi",values:[{name:"xem trạng thái cuộc thi"},{name:"thêm trạng thái cuộc thi"},{name:"sửa trạng thái cuộc thi"},{name:"xóa trạng thái cuộc thi"}],onChangeRoleList:c,userTemp:i})]})]})})]})}const xe=({userList:i,userTemp:u,page:h,onClickOpenDialogDelete:x,onClickSettingRoleUser:m})=>{const r=Q(l=>l.authReducer.roles_x01);return e(ge,{mt:4,children:e(B,{children:d(W,{sx:{minWidth:650},"aria-label":"simple table",children:[e(j,{children:d(N,{children:[e(n,{align:"left",style:{fontSize:"14px"},children:"#"}),e(n,{align:"left",style:{fontSize:"14px"},children:"Tên tài khoản"}),e(n,{align:"left",style:{fontSize:"14px"},children:"Mật khẩu"}),e(n,{align:"left",style:{fontSize:"14px"},children:"Thứ tự"}),e(n,{align:"left",style:{fontSize:"14px"},children:"Quyền hệ thống"}),e(n,{align:"right",style:{fontSize:"14px"},children:"Thao tác"})]})}),e(A,{children:i.map((l,a)=>d(N,{className:u&&l._id===u._id?"bg-gray-300":"",sx:{"&:last-child td, &:last-child th":{border:0}},children:[e(n,{component:"th",scope:"row",children:(h-1)*5+1+a}),e(n,{align:"left",style:{fontWeight:"bold"},children:l.tentaikhoan}),e(n,{align:"left",children:l.matkhau}),e(n,{align:"left",children:l.thutu}),e(n,{align:"left",children:l.roles.toString()}),d(n,{align:"right",style:{minWidth:"200px"},children:[r&&r.includes("sửa tài khoản")&&d(R,{variant:"contained",color:"success",onClick:()=>m(l),size:"small",children:[e(re,{style:{fontSize:"20px",marginRight:"4px"}})," ","Phân quyền"]}),r&&r.includes("xóa tài khoản")&&d(R,{variant:"contained",color:"error",size:"small",style:{marginTop:"4px"},onClick:()=>x(l._id),disabled:u&&l._id===u._id,children:[e(ce,{style:{fontSize:"20px",marginRight:"4px"}})," ","Xóa"]})]})]},l._id))})]})})})},ke=xe;function Le(){const[i,u]=o.useState(""),[h,x]=o.useState(""),[m,r]=o.useState(1),[l,a]=o.useState(!1),[c,v]=o.useState(!0),[b,p]=o.useState([]),[g,s]=o.useState({page:1,total:1}),[P,T]=o.useState(null),q=te(),C=ae();let[be,U]=ne();const[w,z]=o.useState({status:!1,id_Delete:null});o.useState({status:!1,user:null});const I=ie(),O=Q(t=>t.authReducer.roles_x01),D=o.useMemo(()=>{const t=fe.parse(q.search);return{...t,page:Number(t.page)||1}},[q.search]),{enqueueSnackbar:k}=le(),M=()=>{z({...w,status:!1})},V=t=>{z({status:!0,id_Delete:t})},X=t=>{s({...g,page:t});const f={...D,page:t};U(f)},H=async()=>{try{a(!0);let t=await L.addUser({tentaikhoan:i,matkhau:h,thutu:m});a(!1),k("Thêm mới tài khoản thành công!",{anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"success"}),u(""),x(""),r(1),p(t.data.users),s({page:1,total:t.data.total})}catch(t){t.message==="Token không hợp lệ vui lòng đăng nhập hoặc đã hết hạn. Vui lòng đăng nhập lại"&&(C("/login"),k(t.message,{anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"error"})),k(t.response.data.message,{anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"error"})}},$=async t=>{let f=g.page;const E={...t,page:f};try{let y=await L.editUser(E);const Y=localStorage.getItem("accessToken_thitracnghiem"),Z=oe(Y);E.id_edit===Z.userId&&I(he(t.roles)),p(y.data.users),T(null),k(y.data.message,{anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"success"})}catch(y){y.message==="Token không hợp lệ vui lòng đăng nhập hoặc đã hết hạn. Vui lòng đăng nhập lại"&&(C("/login"),k(y.message,{anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"error"})),k(y.message,{anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"error"})}},G=async()=>{try{let t=await L.deleteUser(w.id_Delete);p(t.data.users),s({...g,page:1,total:t.data.total});const f={...D,page:1};U(f),z({...w,status:!1}),k(t.data.message,{anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"success"})}catch(t){t.message==="Token không hợp lệ hoặc đã hết hạn. Vui lòng đăng nhập lại"&&(C("/login"),k(t.message,{anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"error"})),k(t.message,{anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"error"})}},J=()=>{z({...w,status:!1})};o.useEffect(()=>{(async()=>{try{const f=await L.getUsers(D.page);p(f.data.users),s({page:Number(f.data.page),total:f.data.total}),v(!1)}catch(f){f.message==="Token không hợp lệ hoặc đã hết hạn. Vui lòng đăng nhập lại"?(k(f.message,{anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"error"}),C("/login")):(k(f.message,{anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"error"}),C("/login"))}})()},[D]);const K=t=>{T(t)};return d("div",{className:"flex flex-col mx-2 space-x-1 lg:flex-row",children:[d("div",{className:"lg:basis-2/3 bg-white px-4",children:[e("h1",{className:"text-gray-900 text-center mt-2 pt-4 font-bold sm:text-[14px] md:text-[16px]",children:"Quản lý tài khoản người dùng"}),l&&e(F,{}),O&&O.includes("thêm tài khoản")&&d("form",{className:"flex flex-col items-center space-x-0 justify-start mt-8 flex-wrap md:flex-row md:space-x-4",children:[e("div",{className:"my-2 w-full md:w-[auto]",children:e(_,{name:"tentaikhoan",fullWidth:!0,label:"Tên tài khoản",value:i,onChange:t=>u(t.target.value),size:"small"})}),e("div",{className:"my-2 w-full md:w-[auto]",children:e(_,{name:"matkhau",fullWidth:!0,label:"Mật khẩu",value:h,onChange:t=>x(t.target.value),size:"small"})}),e("div",{className:"my-2 w-full md:w-[auto]",children:e(_,{name:"thutu",fullWidth:!0,label:"Thứ tự",value:m,onChange:t=>r(t.target.value),type:"number",size:"small"})}),e("div",{className:"my-2 w-full md:w-[auto] text-center",children:e(R,{onClick:H,variant:"contained",disabled:l,children:"Thêm mới"})})]}),c?e("div",{className:"mt-2",children:e(me,{variant:"rectangular",width:"100%",height:"450px"})}):d(se,{children:[e(ke,{userList:b,page:g.page,onClickOpenDialogDelete:V,onClickSettingRoleUser:K,userTemp:P}),e(ue,{page:g.page,totalPage:g.total,onChangePage:X})]})]}),e("div",{className:"lg:basis-1/3 bg-white",children:e(pe,{userTemp:P,onHandleEditUser:$})}),e(de,{open:w.status,onCloseDialogDelete:M,onConfirmDelete:G,onCancelDelete:J})]})}export{Le as default};
