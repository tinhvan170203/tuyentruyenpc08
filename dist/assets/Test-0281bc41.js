import{r as s,j as e,F as I,d,S as j,s as M,I as B,D as F,h as J,l as y,p as z,C as L,af as A,ae as O}from"./index-91b1f472.js";import{c as D}from"./commonApi-ecfba693.js";import{a as K}from"./Radio-38c15278.js";import{P as V}from"./PreviewBaithi-29e2792f.js";function W(n){n<0&&(n=0);let t=n/1e3;const a=Math.floor(t/3600);t=t%3600;const r=Math.floor(t/60);t=t%60;const o=t.toFixed(0).padStart(2,"0"),c=r.toString().padStart(2,"0");return a===0?`${c} : ${o}`:`${a.toString().padStart(2,"0")}:${c}:${o}`}const X=({thoigianketthuc:n,onHandleSubmitTest:t,stop:a,timeNow:r})=>{const[o,c]=s.useState(1e15),[u,l]=s.useState(!1);s.useEffect(()=>{if(r){let w=n-r;l(!0),c(w)}},[r]);let g=s.useRef();const v=()=>c(w=>w-1e3);return s.useEffect(()=>(g.current=setInterval(v,1e3),()=>clearInterval(g.current)),[]),s.useEffect(()=>{o<=0&&(clearInterval(g.current),t())},[o]),s.useEffect(()=>{a&&clearInterval(g.current)},[a]),e(I,{children:u&&e("div",{className:"[text-shadow:_1px_1px_2px_black] text-white md:text-white text-sm md:text-lg font-semibold",children:W(o)})})},G=({question:n,index:t,onHandleChangeChoice:a,isReplay:r})=>{const[o,c]=s.useState(()=>n.choice),u=l=>{c(l.target.value),a(n._id,l.target.value)};return d("div",{className:"mb-1",children:[d("h4",{className:"font-semibold text-black text-sm md:text-[16px]",children:[d("span",{className:"font-bold",children:["Câu ",t,": "]})," ",n.question]}),e("div",{children:n.image&&n.image!==""&&e("div",{className:"flex justify-center items-center my-4",children:e("img",{src:n.image,alt:"image",className:"w-full md:w-[400px]"})})}),e("ul",{className:"flex flex-col flex-wrap md:flex-row",children:n.options.map((l,g)=>d("li",{className:"flex items-start md:basis-full",children:[e(K,{name:n._id,onChange:u,checked:o===Object.keys(l)[0],value:Object.keys(l)[0]}),e("span",{className:"text-sm md:text-[16px] pt-[10px]",children:l[Object.keys(l)[0]]})]},g))})]})};function U(n){n<0&&(n=0);let t=n/1e3;const a=Math.floor(t/3600);t=t%3600;const r=Math.floor(t/60);t=t%60;const o=t.toFixed(0).padStart(2,"0"),c=r.toString().padStart(2,"0");return a===0?`${c} : ${o}`:`${a.toString().padStart(2,"0")}:${c}:${o}`}const Z=s.forwardRef(function(t,a){return e(j,{direction:"up",ref:a,...t})});M(B)({position:"absolute",right:"16px",top:"4px"});function ee({open:n,onCloseDialogSuccessTest:t,result:a,onSubmit:r,onOpenPreviewMode:o}){const c=()=>{r()};return e(I,{children:e(F,{fullWidth:!0,disableEscapeKeyDown:!0,onClose:(u,l)=>{l!=="backdropClick"&&t(u,l)},open:n,TransitionComponent:Z,keepMounted:!0,"aria-describedby":"alert-dialog-slide-description",children:d(J,{children:[e("p",{className:"text-center text-sm md:text-lg uppercase",children:"Cảm ơn bạn đã làm bài kiểm tra!"}),e("img",{src:"/thanks.png",alt:"img"}),d("p",{className:"text-center text-sm md:text-lg text-green-700",children:["Chúc mừng bạn đã hoàn thành bài thi với ",d("span",{className:"font-bold",children:[a.choicedTrue,"/",a.allQuestion]})," câu trả lời đúng trong khoảng thời gian ",U(a.time)]}),d("div",{className:"md:flex-row md:items-center md:justify-center md:space-x-2 flex flex-col justify-center items-center",children:[e("div",{children:e(y,{color:"error",variant:"contained",type:"submit",size:"small",style:{margin:"4px auto"},onClick:c,children:e("span",{children:"Thoát"})})}),e("div",{children:e(y,{color:"warning",variant:"contained",type:"submit",size:"small",style:{margin:"4px auto"},onClick:o,children:e("span",{children:"Xem lại bài thi"})})})]})]})})})}s.forwardRef(function(t,a){return e(j,{direction:"up",ref:a,...t})});M(B)({position:"absolute",right:"16px",top:"4px"});const le=()=>{const[n,t]=s.useState(null),[a,r]=s.useState(!1),o=()=>{r(!1)},[c,u]=s.useState(!1),l=()=>{u(!1)},g=()=>{u(!0)},v=z(),{enqueueSnackbar:w}=L(),[x,te]=s.useState(()=>JSON.parse(localStorage.getItem("thongtinthisinh"))),[S,k]=s.useState([]),[p,ne]=s.useState(()=>JSON.parse(localStorage.getItem("thongtinbaithi")));s.useState(!1);const[E,se]=s.useState(!1),[_,$]=s.useState({choicedTrue:0,allQuestion:0,time:0}),[H,P]=s.useState(!1),[q,T]=s.useState(!1);s.useEffect(()=>{let i=JSON.parse(localStorage.getItem("question_list"));if(!i)return;let h=[];i.forEach(f=>{let b=[];f.options_sort.forEach(m=>b=[...b,{[m]:f.questionlist[m]}]);const N=b.map(m=>Object.fromEntries(Object.entries(m).filter(([ae,Y])=>Y!==""))).filter(m=>Object.keys(m).length>0);h.push({question:f.questionlist.question,image:f.questionlist.image,choice:f.questionlist.choice,_id:f.questionlist._id,options:N})}),k(h)},[]),s.useEffect(()=>{(!x||!S||!p)&&v("/tracnghiem"),(async()=>{try{let h=await D.checkedTest(p._id);t(h.data.timeNow)}catch{v("/tracnghiem")}})()},[]);const R=(i,h)=>{let f=S.map(m=>m._id.toString()===i?{...m,choice:h}:m),b=JSON.parse(localStorage.getItem("question_list")),N=b.find(m=>m.questionlist._id===i);N.questionlist.choice=h,localStorage.setItem("question_list",JSON.stringify(b)),k(f)},C=async()=>{try{T(!0);let i=await D.submitTest(p._id,S);$({..._,choicedTrue:i.data.choicedTrue,allQuestion:i.data.allQuestion,time:i.data.timeTest}),T(!1),P(!0),r(!0)}catch(i){console.log(i),w(i.message,{anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"error"})}},Q=()=>{localStorage.removeItem("thongtinthisinh"),localStorage.removeItem("question_list"),localStorage.removeItem("thongtinbaithi"),r(!1),v("/tracnghiem")};return e("div",{children:d("div",{className:"flex-1",children:[e("div",{className:"shadow-md shadow-slate-400 h-[150px] md:h-auto bg-center py-2 bg-cover sticky top-0 bg-[url('/bannermobile.png')] md:bg-[url('/backgroundesktop.png')] z-10 flex justify-center",children:d("div",{className:"",children:[d("div",{className:"flex items-center justify-center",children:[e("img",{src:"/cong-an-hieu.png",className:"md:w-24 w-12"}),e("img",{src:"/logoc08.png",className:"md:w-[64px] w-8"})]}),e("h3",{className:"text-center text-[11px] md:text-lg md:text-white uppercase text-[#ffee00] drop-shadow [text-shadow:_1px_1px_4px_black] font-bold",children:"Công an tỉnh Hưng Yên"}),e("h3",{className:"text-center text-[11px] md:text-lg md:text-white uppercase text-[#ffee00] drop-shadow [text-shadow:_1px_1px_4px_black] font-bold",children:"Phòng cảnh sát giao thông"}),e("div",{className:"text-center",children:e(X,{timeNow:n,stop:H,onHandleSubmitTest:C,thoigianketthuc:p==null?void 0:p.thoigianketthuc})})]})}),e("h3",{className:"text-center text-sm mt-4 md:text-[18px] text-[#ab0000] font-semibold md:font-normal",children:x==null?void 0:x.tencuocthi}),d("p",{className:"text-center font-semibold text-[12px] md:text-[18px]",children:["Ngày tổ chức:"," ",A(x==null?void 0:x.ngaytochucthi).format("DD/MM/YYYY")]}),e("div",{className:"md:px-12 mt-2 py-1 md:mx-10 px-2 shadow-sm shadow-slate-700",children:S==null?void 0:S.map((i,h)=>e(G,{question:i,index:h+1,onHandleChangeChoice:R},i._id))}),e("div",{className:"flex items-center justify-center my-2 mb-20",children:e(y,{variant:"contained",onClick:()=>C(),children:"Nộp bài thi"})}),d("div",{className:"px-2 bg-[url('/nentrongdong.png')] bg-cover bg-center mt-4 fixed bottom-0 w-full py-1",children:[e("p",{className:"text-center font-semibold text-[12px] text-[#ab0000] md:text-[16px] ",children:"Bản quyền thuộc về Phòng Cảnh sát giao thông"}),e("p",{className:"text-center text-[12px] font-normal text-[#ab0000] md:text-[16px]",children:"Ứng dụng công nghệ thông tin trong công tác tuyên truyền, phổ biến, giáo dục pháp luật trên địa bàn tỉnh Hưng Yên"})]}),E&&e(O,{}),e(ee,{open:a,onCloseDialogSuccessTest:o,result:_,onSubmit:Q,onOpenPreviewMode:g}),e(V,{open:c,onCloseDialogPreviewBaithi:l,idBaithi:p==null?void 0:p._id}),e(O,{open:q})]})})};export{le as default};
