import{r as n,j as e,F as j,d as m,S as I,s as M,I as B,B as w,g as F,i as J}from"./index-239067be.js";import{d as L,M as D}from"./ModalLoading-2e0626ea.js";import{c as _}from"./commonApi-41218345.js";import{a as Y}from"./Radio-4d01ebe2.js";import{D as K,a as A}from"./Cancel-26ae82a6.js";import{P as V}from"./PreviewBaithi-53d54cb2.js";import"./axiosCommon-9047ae46.js";function W(s){s<0&&(s=0);let t=s/1e3;const a=Math.floor(t/3600);t=t%3600;const r=Math.floor(t/60);t=t%60;const o=t.toFixed(0).padStart(2,"0"),c=r.toString().padStart(2,"0");return a===0?`${c} : ${o}`:`${a.toString().padStart(2,"0")}:${c}:${o}`}const X=({thoigianketthuc:s,onHandleSubmitTest:t,stop:a,timeNow:r})=>{const[o,c]=n.useState(1e15),[u,l]=n.useState(!1);n.useEffect(()=>{if(r){let N=s-r;l(!0),c(N)}},[r]);let p=n.useRef();const v=()=>c(N=>N-1e3);return n.useEffect(()=>(p.current=setInterval(v,1e3),()=>clearInterval(p.current)),[]),n.useEffect(()=>{o<=0&&(clearInterval(p.current),t())},[o]),n.useEffect(()=>{a&&clearInterval(p.current)},[a]),e(j,{children:u&&e("div",{className:"text-green-900 text-sm md:text-lg font-semibold",children:W(o)})})},G=({question:s,index:t,onHandleChangeChoice:a,isReplay:r})=>{const[o,c]=n.useState(()=>s.choice),u=l=>{c(l.target.value),a(s._id,l.target.value)};return m("div",{className:"mb-8",children:[m("h4",{className:"font-semibold text-black text-sm md:text-[16px]",children:[m("span",{className:"font-bold",children:["Câu ",t,": "]})," ",s.question]}),e("ul",{className:"flex flex-col flex-wrap md:flex-row",children:s.options.map((l,p)=>m("li",{className:"flex items-start md:basis-1/2",children:[e(Y,{name:s._id,onChange:u,checked:o===Object.keys(l)[0],value:Object.keys(l)[0]}),e("span",{className:"text-sm md:text-[16px] pt-[10px]",children:l[Object.keys(l)[0]]})]},p))})]})};function U(s){s<0&&(s=0);let t=s/1e3;const a=Math.floor(t/3600);t=t%3600;const r=Math.floor(t/60);t=t%60;const o=t.toFixed(0).padStart(2,"0"),c=r.toString().padStart(2,"0");return a===0?`${c} : ${o}`:`${a.toString().padStart(2,"0")}:${c}:${o}`}const Z=n.forwardRef(function(t,a){return e(I,{direction:"up",ref:a,...t})});M(B)({position:"absolute",right:"16px",top:"4px"});function ee({open:s,onCloseDialogSuccessTest:t,result:a,onSubmit:r,onOpenPreviewMode:o}){const c=()=>{r()};return e(j,{children:e(K,{fullWidth:!0,disableEscapeKeyDown:!0,onClose:(u,l)=>{l!=="backdropClick"&&t(u,l)},open:s,TransitionComponent:Z,keepMounted:!0,"aria-describedby":"alert-dialog-slide-description",children:m(A,{children:[e("p",{className:"text-center text-sm md:text-lg uppercase",children:"Cảm ơn bạn đã tham gia bài kiểm tra!"}),e("img",{src:"/thanks.png",alt:"img"}),m("p",{className:"text-center text-sm md:text-lg text-green-700",children:["Chúc mừng bạn đã hoàn thành bài thi với ",m("span",{className:"font-bold",children:[a.choicedTrue,"/",a.allQuestion]})," câu trả lời đúng trong khoảng thời gian ",U(a.time)]}),m("div",{className:"md:flex-row md:items-center md:justify-center md:space-x-2 flex flex-col justify-center items-center",children:[e("div",{children:e(w,{color:"error",variant:"contained",type:"submit",size:"small",style:{margin:"4px auto"},onClick:c,children:e("span",{children:"Kết thúc"})})}),e("div",{children:e(w,{color:"warning",variant:"contained",type:"submit",size:"small",style:{margin:"4px auto"},onClick:o,children:e("span",{children:"Xem lại bài thi"})})})]})]})})})}n.forwardRef(function(t,a){return e(I,{direction:"up",ref:a,...t})});M(B)({position:"absolute",right:"16px",top:"4px"});const ue=()=>{const[s,t]=n.useState(null),[a,r]=n.useState(!1),o=()=>{r(!1)},[c,u]=n.useState(!1),l=()=>{u(!1)},p=()=>{u(!0)},v=F(),{enqueueSnackbar:N}=J(),[f,te]=n.useState(()=>JSON.parse(localStorage.getItem("thongtinthisinh"))),[S,k]=n.useState([]),[g,ne]=n.useState(()=>JSON.parse(localStorage.getItem("thongtinbaithi")));n.useState(!1);const[E,se]=n.useState(!1),[C,$]=n.useState({choicedTrue:0,allQuestion:0,time:0}),[H,P]=n.useState(!1),[q,T]=n.useState(!1);n.useEffect(()=>{let i=JSON.parse(localStorage.getItem("question_list"));if(!i)return;let h=[];i.forEach(x=>{let b=[];x.options_sort.forEach(d=>b=[...b,{[d]:x.questionlist[d]}]);const y=b.map(d=>Object.fromEntries(Object.entries(d).filter(([ae,z])=>z!==""))).filter(d=>Object.keys(d).length>0);h.push({question:x.questionlist.question,choice:x.questionlist.choice,_id:x.questionlist._id,options:y})}),k(h)},[]),n.useEffect(()=>{(!f||!S||!g)&&v("/tracnghiem"),(async()=>{try{let h=await _.checkedTest(g._id);t(h.data.timeNow)}catch{v("/tracnghiem")}})()},[]);const R=(i,h)=>{let x=S.map(d=>d._id.toString()===i?{...d,choice:h}:d),b=JSON.parse(localStorage.getItem("question_list")),y=b.find(d=>d.questionlist._id===i);y.questionlist.choice=h,localStorage.setItem("question_list",JSON.stringify(b)),k(x)},O=async()=>{try{T(!0);let i=await _.submitTest(g._id,S);$({...C,choicedTrue:i.data.choicedTrue,allQuestion:i.data.allQuestion,time:i.data.timeTest}),T(!1),P(!0),r(!0)}catch(i){console.log(i),N(i.message,{anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"error"})}},Q=()=>{localStorage.removeItem("thongtinthisinh"),localStorage.removeItem("question_list"),localStorage.removeItem("thongtinbaithi"),r(!1),v("/tracnghiem")};return e("div",{children:m("div",{className:"flex-1",children:[e("div",{className:"shadow-md shadow-slate-400 h-[150px] md:h-auto bg-center py-2 bg-cover sticky top-0 bg-[url('/banner.jpg')] md:bg-[url('/nentrongdong.png')] z-10 flex justify-center",children:m("div",{className:"",children:[e("div",{className:"flex justify-center",children:e("img",{src:"/cong-an-hieu.png",className:"md:w-36 w-12"})}),e("h3",{className:"text-center text-[11px] md:text-lg uppercase text-[#ab0000] font-bold",children:"Công an tỉnh Hưng Yên"}),e("h3",{className:"text-center text-[11px] md:text-lg uppercase text-[#ab0000] font-bold",children:"Phòng cảnh sát giao thông"}),e("div",{className:"text-center",children:e(X,{timeNow:s,stop:H,onHandleSubmitTest:O,thoigianketthuc:g==null?void 0:g.thoigianketthuc})})]})}),e("h3",{className:"text-center text-sm mt-4 md:text-[18px] text-red-900 font-bold",children:f==null?void 0:f.tencuocthi}),m("p",{className:"text-center font-semibold text-[12px] md:text-[18px]",children:["Ngày tổ chức:"," ",L(f==null?void 0:f.ngaytochucthi).format("DD/MM/YYYY")]}),e("div",{className:"fixed md:hidden inset-0 bottom-[-100px] flex items-center justify-center pointer-events-none z-0",children:e("img",{src:"/logoc08.png",className:"opacity-20 h-[40vh] md:h-[60vh] object-contain",alt:""})}),e("div",{className:"md:px-12 mt-2 py-2 md:mx-10 px-2 shadow-sm shadow-slate-700",children:S==null?void 0:S.map((i,h)=>e(G,{question:i,index:h+1,onHandleChangeChoice:R},i._id))}),e("div",{className:"flex items-center justify-center my-2 mb-20",children:e(w,{variant:"contained",onClick:()=>O(),children:"Nộp bài thi"})}),m("div",{className:"px-2 bg-[url('/nentrongdong.png')] bg-cover bg-center mt-4 fixed bottom-0 w-full py-1",children:[e("p",{className:"text-center font-semibold text-[12px] text-[#ab0000] md:text-md ",children:"Bản quyền thuộc về Phòng Cảnh sát giao thông"}),e("p",{className:"text-center font-semibold text-[12px] text-[#ab0000] md:text-md",children:"Chuyển đổi số trong công tác tuyên truyền phổ biến pháp luật"}),e("p",{className:"text-center font-semibold text-[#ab0000] text-[12px] md:text-md",children:"@2026 - Cuộc thi tìm hiểu Luật trật tự, an toàn giao thông đường bộ dành cho Học sinh"})]}),E&&e(D,{}),e(ee,{open:a,onCloseDialogSuccessTest:o,result:C,onSubmit:Q,onOpenPreviewMode:p}),e(V,{open:c,onCloseDialogPreviewBaithi:l,idBaithi:g==null?void 0:g._id}),e(D,{open:q})]})})};export{ue as default};
