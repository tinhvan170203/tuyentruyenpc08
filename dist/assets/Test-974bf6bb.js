import{r as n,j as e,F as j,d as u,S as I,s as M,I as B,D as z,h as F,l as k,p as J,C as L,aK as K,ae as D}from"./index-ef018a59.js";import{c as _}from"./commonApi-570317d6.js";import{a as A}from"./Radio-a1d31a80.js";import{P as V}from"./PreviewBaithi-46373255.js";function W(s){s<0&&(s=0);let t=s/1e3;const a=Math.floor(t/3600);t=t%3600;const r=Math.floor(t/60);t=t%60;const o=t.toFixed(0).padStart(2,"0"),c=r.toString().padStart(2,"0");return a===0?`${c} : ${o}`:`${a.toString().padStart(2,"0")}:${c}:${o}`}const X=({thoigianketthuc:s,onHandleSubmitTest:t,stop:a,timeNow:r})=>{const[o,c]=n.useState(1e15),[m,l]=n.useState(!1);n.useEffect(()=>{if(r){let N=s-r;l(!0),c(N)}},[r]);let p=n.useRef();const v=()=>c(N=>N-1e3);return n.useEffect(()=>(p.current=setInterval(v,1e3),()=>clearInterval(p.current)),[]),n.useEffect(()=>{o<=0&&(clearInterval(p.current),t())},[o]),n.useEffect(()=>{a&&clearInterval(p.current)},[a]),e(j,{children:m&&e("div",{className:"text-green-900 text-sm md:text-lg font-semibold",children:W(o)})})},G=({question:s,index:t,onHandleChangeChoice:a,isReplay:r})=>{const[o,c]=n.useState(()=>s.choice),m=l=>{c(l.target.value),a(s._id,l.target.value)};return u("div",{className:"mb-1",children:[u("h4",{className:"font-semibold text-black text-sm md:text-[16px]",children:[u("span",{className:"font-bold",children:["Câu ",t,": "]})," ",s.question]}),e("ul",{className:"flex flex-col flex-wrap md:flex-row",children:s.options.map((l,p)=>u("li",{className:"flex items-start md:basis-1/2",children:[e(A,{name:s._id,onChange:m,checked:o===Object.keys(l)[0],value:Object.keys(l)[0]}),e("span",{className:"text-sm md:text-[16px] pt-[10px]",children:l[Object.keys(l)[0]]})]},p))})]})};function U(s){s<0&&(s=0);let t=s/1e3;const a=Math.floor(t/3600);t=t%3600;const r=Math.floor(t/60);t=t%60;const o=t.toFixed(0).padStart(2,"0"),c=r.toString().padStart(2,"0");return a===0?`${c} : ${o}`:`${a.toString().padStart(2,"0")}:${c}:${o}`}const Z=n.forwardRef(function(t,a){return e(I,{direction:"up",ref:a,...t})});M(B)({position:"absolute",right:"16px",top:"4px"});function ee({open:s,onCloseDialogSuccessTest:t,result:a,onSubmit:r,onOpenPreviewMode:o}){const c=()=>{r()};return e(j,{children:e(z,{fullWidth:!0,disableEscapeKeyDown:!0,onClose:(m,l)=>{l!=="backdropClick"&&t(m,l)},open:s,TransitionComponent:Z,keepMounted:!0,"aria-describedby":"alert-dialog-slide-description",children:u(F,{children:[e("p",{className:"text-center text-sm md:text-lg uppercase",children:"Cảm ơn bạn đã làm bài kiểm tra!"}),e("img",{src:"/thanks.png",alt:"img"}),u("p",{className:"text-center text-sm md:text-lg text-green-700",children:["Chúc mừng bạn đã hoàn thành bài thi với ",u("span",{className:"font-bold",children:[a.choicedTrue,"/",a.allQuestion]})," câu trả lời đúng trong khoảng thời gian ",U(a.time)]}),u("div",{className:"md:flex-row md:items-center md:justify-center md:space-x-2 flex flex-col justify-center items-center",children:[e("div",{children:e(k,{color:"error",variant:"contained",type:"submit",size:"small",style:{margin:"4px auto"},onClick:c,children:e("span",{children:"Kết thúc"})})}),e("div",{children:e(k,{color:"warning",variant:"contained",type:"submit",size:"small",style:{margin:"4px auto"},onClick:o,children:e("span",{children:"Xem lại bài thi"})})})]})]})})})}n.forwardRef(function(t,a){return e(I,{direction:"up",ref:a,...t})});M(B)({position:"absolute",right:"16px",top:"4px"});const le=()=>{const[s,t]=n.useState(null),[a,r]=n.useState(!1),o=()=>{r(!1)},[c,m]=n.useState(!1),l=()=>{m(!1)},p=()=>{m(!0)},v=J(),{enqueueSnackbar:N}=L(),[f,te]=n.useState(()=>JSON.parse(localStorage.getItem("thongtinthisinh"))),[S,w]=n.useState([]),[g,ne]=n.useState(()=>JSON.parse(localStorage.getItem("thongtinbaithi")));n.useState(!1);const[E,se]=n.useState(!1),[C,H]=n.useState({choicedTrue:0,allQuestion:0,time:0}),[$,P]=n.useState(!1),[q,T]=n.useState(!1);n.useEffect(()=>{let i=JSON.parse(localStorage.getItem("question_list"));if(!i)return;let h=[];i.forEach(x=>{let b=[];x.options_sort.forEach(d=>b=[...b,{[d]:x.questionlist[d]}]);const y=b.map(d=>Object.fromEntries(Object.entries(d).filter(([ae,Y])=>Y!==""))).filter(d=>Object.keys(d).length>0);h.push({question:x.questionlist.question,choice:x.questionlist.choice,_id:x.questionlist._id,options:y})}),w(h)},[]),n.useEffect(()=>{(!f||!S||!g)&&v("/tracnghiem"),(async()=>{try{let h=await _.checkedTest(g._id);t(h.data.timeNow)}catch{v("/tracnghiem")}})()},[]);const R=(i,h)=>{let x=S.map(d=>d._id.toString()===i?{...d,choice:h}:d),b=JSON.parse(localStorage.getItem("question_list")),y=b.find(d=>d.questionlist._id===i);y.questionlist.choice=h,localStorage.setItem("question_list",JSON.stringify(b)),w(x)},O=async()=>{try{T(!0);let i=await _.submitTest(g._id,S);H({...C,choicedTrue:i.data.choicedTrue,allQuestion:i.data.allQuestion,time:i.data.timeTest}),T(!1),P(!0),r(!0)}catch(i){console.log(i),N(i.message,{anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"error"})}},Q=()=>{localStorage.removeItem("thongtinthisinh"),localStorage.removeItem("question_list"),localStorage.removeItem("thongtinbaithi"),r(!1),v("/tracnghiem")};return e("div",{children:u("div",{className:"flex-1",children:[e("div",{className:"shadow-md shadow-slate-400 h-[150px] md:h-auto bg-center py-2 bg-cover sticky top-0 bg-[url('/banner.jpg')] md:bg-[url('/bannerdesktop.png')] z-10 flex justify-center",children:u("div",{className:"",children:[e("div",{className:"flex justify-center",children:e("img",{src:"/cong-an-hieu.png",className:"md:w-28 w-12"})}),e("h3",{className:"text-center text-[11px] md:text-lg uppercase text-[#ab0000] font-bold",children:"Công an tỉnh Hưng Yên"}),e("h3",{className:"text-center text-[11px] md:text-lg uppercase text-[#ab0000] font-bold",children:"Phòng cảnh sát giao thông"}),e("div",{className:"text-center",children:e(X,{timeNow:s,stop:$,onHandleSubmitTest:O,thoigianketthuc:g==null?void 0:g.thoigianketthuc})})]})}),e("h3",{className:"text-center text-sm mt-4 md:text-[18px] text-[#ab0000] font-bold",children:f==null?void 0:f.tencuocthi}),u("p",{className:"text-center font-semibold text-[12px] md:text-[18px]",children:["Ngày tổ chức:"," ",K(f==null?void 0:f.ngaytochucthi).format("DD/MM/YYYY")]}),e("div",{className:"fixed md:hidden inset-0 bottom-[-100px] flex items-center justify-center pointer-events-none z-0",children:e("img",{src:"/logoc08.png",className:"opacity-20 h-[40vh] md:h-[60vh] object-contain",alt:""})}),e("div",{className:"md:px-12 mt-2 py-1 md:mx-10 px-2 shadow-sm shadow-slate-700",children:S==null?void 0:S.map((i,h)=>e(G,{question:i,index:h+1,onHandleChangeChoice:R},i._id))}),e("div",{className:"flex items-center justify-center my-2 mb-24",children:e(k,{variant:"contained",onClick:()=>O(),children:"Nộp bài thi"})}),u("div",{className:"px-2 bg-[url('/nentrongdong.png')] bg-cover bg-center mt-4 fixed bottom-0 w-full py-1",children:[e("p",{className:"text-center font-semibold text-[12px] text-[#ab0000] md:text-[16px] ",children:"Bản quyền thuộc về Phòng Cảnh sát giao thông"}),e("p",{className:"text-center font-semibold text-[12px] text-[#ab0000] md:text-[16px]",children:"Ứng dụng công nghệ thông tin trong tuyên truyền pháp luật"}),e("p",{className:"text-center font-semibold text-[#ab0000] text-[12px] md:text-[16px]",children:"@2026 - Cuộc thi tìm hiểu Luật trật tự, an toàn giao thông đường bộ dành cho Học sinh tỉnh Hưng Yên"})]}),E&&e(D,{}),e(ee,{open:a,onCloseDialogSuccessTest:o,result:C,onSubmit:Q,onOpenPreviewMode:p}),e(V,{open:c,onCloseDialogPreviewBaithi:l,idBaithi:g==null?void 0:g._id}),e(D,{open:q})]})})};export{le as default};
