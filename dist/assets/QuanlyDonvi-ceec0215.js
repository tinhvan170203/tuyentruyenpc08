import{r as m,j as e,S as L,s as P,I as B,c as F,a as w,b as A,u as O,F as N,d as i,D as j,e as R,f as W,g as I,h as K,B as V,L as M,G as u,i as y,k as Q,l as x,m as _,o as G,Z as k,n as X,T as ce,q as he,t as ue,v as E,w as v,x as ge,y as pe,z as me,A as fe,p as ve,C as be,E as ye}from"./index-dc3c6106.js";import{S as xe,P as De}from"./PaginationComponent-31facd77.js";import{d as ke,a as Se}from"./Backspace-17452d81.js";import{q as Ce}from"./base-312a79a2.js";const Te=m.forwardRef(function(t,a){return e(L,{direction:"up",ref:a,...t})}),we=P(B)({position:"absolute",right:"16px",top:"4px"}),ze=F({tendonvi:w().required("Lỗi: Vui lòng nhập tên đơn vị"),kyhieu:w().required("Lỗi: Vui lòng nhập ký hiệu đơn vị"),thutu:A().required("Lỗi: Vui lòng nhập thứ tự").min(1,"Thứ tự phải lớn hơn 1")}).required();function Oe({open:l,onCloseDialogAddDonvi:t,onSubmit:a}){const d=O({defaultValues:{tendonvi:"",kyhieu:"",thutu:1},resolver:G(ze)}),r=async c=>{a&&(await a(c),d.reset())},{isSubmitting:s}=d.formState;return e(N,{children:i(j,{maxWidth:"lg",fullWidth:!0,disableEscapeKeyDown:!0,onClose:(c,g)=>{g!=="backdropClick"&&t(c,g)},open:l,TransitionComponent:Te,keepMounted:!0,"aria-describedby":"alert-dialog-slide-description",children:[i(R,{style:{display:"flex",borderBottom:"1px solid #ccc",margin:"0 12px"},children:[e(W,{style:{color:"#333",fontSize:"32px"}}),e("span",{children:"Thêm mới đơn vị"}),e(we,{onClick:()=>t(),children:e(I,{style:{color:"#d32b2b"}})})]}),e(K,{children:i(V,{children:[s?e(M,{}):"",i("form",{onSubmit:d.handleSubmit(r),style:{width:"100%"},children:[i(u,{container:!0,spacing:1,style:{alignItems:"center",justifyContent:"center"},children:[e(u,{item:!0,xs:12,md:6,lg:6,children:e(y,{name:"tendonvi",form:d,label:"Tên đơn vị *",type:"text",disabled:!1})}),e(u,{item:!0,xs:12,md:6,lg:4,children:e(y,{name:"kyhieu",form:d,label:"Ký hiệu đơn vị *",type:"text",disabled:!1})}),e(u,{item:!0,xs:12,md:6,lg:2,children:e(y,{name:"thutu",form:d,label:"Thứ tự",type:"number",disabled:!1})})]}),e(Q,{children:i(x,{color:"primary",variant:"contained",disabled:s,type:"submit",style:{margin:"4px auto"},children:[e(_,{}),e("span",{children:"Thêm mới"})]})})]})]})})]})})}const T={getDonvi(l){const t="api/donvi/fetch";return k.get(t,{params:l})},getDonviQuanly(l){const t="api/donviquanly/fetch";return k.get(t,{params:l})},addDonvi(l){const t="api/donvi/add";return k.post(t,l)},editDonvi(l){const t=`api/donvi/edit/${l.id_edit}`;return k.put(t,l)},deleteDonvi(l,t){const a=`api/donvi/delete/${l}`;return k.delete(a,{params:t})}},Ve=({donviList:l,page:t,onClickOpenDialogDelete:a,onClickOpenDialogEditDonvi:d})=>{const r=X(s=>s.authReducer.roles_x01);return e(V,{mt:4,children:e(ce,{children:i(he,{sx:{minWidth:650},"aria-label":"simple table",children:[e(ue,{style:{backgroundColor:"#1976d2"},children:i(E,{children:[e(v,{align:"left",style:{fontSize:"14px",color:"#fff",padding:"8px 8px"},children:"#"}),e(v,{align:"left",style:{fontSize:"14px",color:"#fff",padding:"8px 8px"},children:"Tên đơn vị"}),e(v,{align:"left",style:{fontSize:"14px",color:"#fff",padding:"8px 8px"},children:"Ký hiệu"}),e(v,{align:"left",style:{fontSize:"14px",color:"#fff",padding:"8px 8px"},children:"Thứ tự"}),e(v,{align:"right",style:{fontSize:"14px",color:"#fff",padding:"8px 8px"},children:"Thao tác"})]})}),e(ge,{children:l.map((s,c)=>i(E,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[e(v,{component:"th",scope:"row",children:(t-1)*5+1+c}),e(v,{align:"left",style:{fontWeight:"bold"},children:s.tendonvi}),e(v,{align:"left",children:s.kyhieu}),e(v,{align:"left",children:s.thutu}),i(v,{align:"right",children:[r&&r.includes("sửa đơn vị")&&i(x,{variant:"contained",color:"success",size:"small",onClick:()=>d(s),children:[e(pe,{style:{fontSize:"20px",marginRight:"4px"}})," ","Sửa"]}),r&&r.includes("xóa đơn vị")&&i(x,{variant:"contained",color:"error",size:"small",style:{marginLeft:"4px"},onClick:()=>a(s._id),children:[e(me,{style:{fontSize:"20px",marginRight:"4px"}})," ","Xóa"]})]})]},s._id))})]})})})},_e=m.forwardRef(function(t,a){return e(L,{direction:"up",ref:a,...t})}),qe=P(B)({position:"absolute",right:"16px",top:"4px"}),$e=F({tendonvi:w().required("Lỗi: Vui lòng nhập tên tài khoản"),kyhieu:w().required("Lỗi: Vui lòng nhập ký hiệu"),thutu:A().required("Lỗi: Vui lòng nhập thứ tự").min(1,"Thứ tự phải lớn hơn 1")}).required();function Ee({open:l,onCloseDialogEditDonvi:t,donvi:a,onSubmit:d}){const r=O({defaultValues:{tendonvi:"  ",kyhieu:" ",thutu:1},resolver:G($e)}),s=r.setValue;m.useEffect(()=>{a&&(s("tendonvi",a.tendonvi,{shouldValidate:!0}),s("thutu",a.thutu,{shouldValidate:!0}),s("kyhieu",a.kyhieu,{shouldValidate:!0}))},[a]);const c=async h=>{if(d){const f={...h,id_edit:a._id};await d(f),t()}},{isSubmitting:g}=r.formState;return e(N,{children:i(j,{maxWidth:"lg",fullWidth:!0,disableEscapeKeyDown:!0,onClose:(h,f)=>{f!=="backdropClick"&&t(h,f)},open:l,TransitionComponent:_e,keepMounted:!0,"aria-describedby":"alert-dialog-slide-description",children:[i(R,{style:{display:"flex",borderBottom:"1px solid #ccc",margin:"0 12px"},children:[e(W,{style:{color:"#333",fontSize:"32px"}}),e("span",{children:"Chỉnh sửa đơn vị"}),e(qe,{onClick:()=>t(),children:e(I,{style:{color:"#d32b2b"}})})]}),e(K,{children:i(V,{children:[g?e(M,{}):"",i("form",{onSubmit:r.handleSubmit(c),style:{width:"100%"},children:[i(u,{container:!0,spacing:1,style:{alignItems:"center",justifyContent:"center"},children:[e(u,{item:!0,xs:12,md:6,lg:6,children:e(y,{name:"tendonvi",form:r,label:"Tên đơn vị *",type:"text",disabled:!1})}),e(u,{item:!0,xs:12,md:6,lg:4,children:e(y,{name:"kyhieu",form:r,label:"Ký hiệu *",type:"text",disabled:!1})}),e(u,{item:!0,xs:12,md:6,lg:2,children:e(y,{name:"thutu",form:r,label:"Thứ tự",type:"number",disabled:!1})})]}),e(Q,{children:i(x,{color:"primary",variant:"contained",disabled:g,type:"submit",style:{margin:"4px auto"},children:[e(_,{}),e("span",{children:"Cập nhật"})]})})]})]})})]})})}const Ae=()=>{const l=X(n=>n.authReducer.roles_x01),[t,a]=m.useState({page:1,total:1});let[d,r]=fe();const[s,c]=m.useState([]),g=ve(),h=m.useMemo(()=>{const n=Ce.parse(location.search);return{...n,kyhieu:n.kyhieu||"",tendonvi:n.tendonvi||"",page:Number(n.page)||1}},[location.search]),[f,S]=m.useState({status:!1,id_Delete:null}),[z,q]=m.useState({status:!1,donvi:null}),[H,$]=m.useState(!1),[Z,D]=m.useState(!1),J=()=>{$(!1)},U=()=>{$(!0)},{enqueueSnackbar:p}=be(),C=O({defaultValues:{tendonvi:"",kyhieu:""}}),Y=n=>{a({...t,page:n});const o={...h,page:n};r(o)},ee=async n=>{r({...h,...n,page:1})};m.useEffect(()=>{(async()=>{try{D(!0);let o=await T.getDonvi(h);c(o.data.donvis),a({page:o.data.page,total:o.data.total}),D(!1)}catch(o){o.message==="Token không hợp lệ hoặc đã hết hạn. Vui lòng đăng nhập lại"&&(g("/login"),p(o.message,{anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"error"})),p(o.message,{anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"error"}),D(!1)}})()},[h]);const te=async n=>{try{let o={...n,queryParams:h};D(!0);let b=await T.addDonvi(o);c(b.data.donvis),a({...t,total:b.data.total}),D(!1),p("Thêm mới đơn vị thành công!",{anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"success"})}catch(o){o.message==="Token không hợp lệ hoặc đã hết hạn. Vui lòng đăng nhập lại"&&(g("/login"),p(o.message,{anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"error"})),p(o.message,{anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"error"}),D(!1),g("/login")}},ne=()=>{C.reset()},ie=n=>{S({status:!0,id_Delete:n})},ae=()=>{q({...z,status:!1})},le=n=>{q({donvi:n,status:!0})},oe=()=>{S({...f,status:!1})},re=async n=>{const o={...n,queryParams:h};try{let b=await T.editDonvi(o);c(b.data.donvis),p(b.data.message,{anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"success"})}catch(b){b.message==="Token không hợp lệ hoặc đã hết hạn. Vui lòng đăng nhập lại"&&(g("/login"),p(b.message,{anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"error"})),p(b.message,{anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"error"})}},se=async()=>{try{let n=await T.deleteDonvi(f.id_Delete,h);c(n.data.donvis),a({total:n.data.total});const o={...h,page:1};r(o),S({...f,status:!1}),p(n.data.message,{anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"success"})}catch(n){n.message==="Token không hợp lệ hoặc đã hết hạn. Vui lòng đăng nhập lại"&&(g("/login"),p(n.message,{anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"error"})),p(n.message,{anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"error"})}},de=()=>{S({...f,status:!1})};return i("div",{className:"mx-2 bg-white pb-2 px-4",children:[e("h3",{className:"text-gray-900 text-center mt-2 pt-4 font-bold sm:text-[14px] md:text-[18px]",children:"Quản lý tên đơn vị cấp phòng, huyện và tương đương"}),l&&l.includes("thêm đơn vị")&&e("div",{className:"text-end my-4",children:i(x,{variant:"contained",onClick:U,children:[e(_,{}),"Thêm mới đơn vị"]})}),e("div",{className:"p-2 rounded-md shadow-lg",children:e("form",{onSubmit:C.handleSubmit(ee),style:{width:"100%"},children:i("fieldset",{style:{border:"1px solid #ccc",paddingBlockEnd:"12px"},children:[e("legend",{style:{paddingInline:"12px",fontWeight:"bold"},children:"Tra cứu đơn vị:"}),i(u,{container:!0,spacing:1,style:{padding:"16px"},children:[e(u,{item:!0,xs:12,md:6,lg:6,children:e(y,{name:"tendonvi",label:"Tên đơn vị",form:C,disabled:!1})}),e(u,{item:!0,xs:12,md:6,lg:6,children:e(y,{name:"kyhieu",label:"Ký hiệu của đơn vị",form:C,disabled:!1})}),e(u,{item:!0,xs:12,md:12,lg:12,children:i("div",{className:"flex flex-col space-y-2 md:space-y-0 md:space-x-2 md:items-center md:justify-center md:flex-row",children:[i(x,{color:"primary",variant:"contained",type:"submit",children:[e(ke,{}),e("span",{children:"Tìm kiếm"})]}),i(x,{variant:"contained",onClick:ne,color:"warning",children:[e("span",{className:"mr-2",children:"Xóa trắng"}),e(Se,{})]})]})})]})]})})}),e("div",{children:Z?e(xe,{variant:"rectangular",width:"100%",height:400}):e(Ve,{donviList:s,page:t.page,onClickOpenDialogDelete:ie,onClickOpenDialogEditDonvi:le})}),e(Oe,{open:H,onCloseDialogAddDonvi:J,onSubmit:te}),e(Ee,{open:z.status,donvi:z.donvi,onCloseDialogEditDonvi:ae,onSubmit:re}),e(ye,{open:f.status,onCloseDialogDelete:oe,onConfirmDelete:se,onCancelDelete:de}),e(De,{page:t.page,totalPage:t.total,onChangePage:Y})]})};export{Ae as default};
