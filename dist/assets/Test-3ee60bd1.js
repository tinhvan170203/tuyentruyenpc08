import{r as s,j as e,F as _,d as m,S as I,s as M,I as B,D as z,h as F,l as w,p as J,C as L,aK as K,ae as j}from"./index-d4d83626.js";import{c as D}from"./commonApi-264a2c55.js";import{a as A}from"./Radio-0b9a5d5d.js";import{P as V}from"./PreviewBaithi-24056a18.js";function W(n){n<0&&(n=0);let t=n/1e3;const a=Math.floor(t/3600);t=t%3600;const r=Math.floor(t/60);t=t%60;const o=t.toFixed(0).padStart(2,"0"),c=r.toString().padStart(2,"0");return a===0?`${c} : ${o}`:`${a.toString().padStart(2,"0")}:${c}:${o}`}const X=({thoigianketthuc:n,onHandleSubmitTest:t,stop:a,timeNow:r})=>{const[o,c]=s.useState(1e15),[u,l]=s.useState(!1);s.useEffect(()=>{if(r){let N=n-r;l(!0),c(N)}},[r]);let p=s.useRef();const v=()=>c(N=>N-1e3);return s.useEffect(()=>(p.current=setInterval(v,1e3),()=>clearInterval(p.current)),[]),s.useEffect(()=>{o<=0&&(clearInterval(p.current),t())},[o]),s.useEffect(()=>{a&&clearInterval(p.current)},[a]),e(_,{children:u&&e("div",{className:"text-green-900 text-sm md:text-lg font-semibold",children:W(o)})})},G=({question:n,index:t,onHandleChangeChoice:a,isReplay:r})=>{const[o,c]=s.useState(()=>n.choice),u=l=>{c(l.target.value),a(n._id,l.target.value)};return m("div",{className:"mb-1",children:[m("h4",{className:"font-semibold text-black text-sm md:text-[16px]",children:[m("span",{className:"font-bold",children:["Câu ",t,": "]})," ",n.question]}),e("div",{children:n.image&&n.image!==""&&e("div",{className:"flex justify-center items-center my-4",children:e("img",{src:n.image,alt:"image",className:"w-full md:w-[400px]"})})}),e("ul",{className:"flex flex-col flex-wrap md:flex-row",children:n.options.map((l,p)=>m("li",{className:"flex items-start md:basis-1/2",children:[e(A,{name:n._id,onChange:u,checked:o===Object.keys(l)[0],value:Object.keys(l)[0]}),e("span",{className:"text-sm md:text-[16px] pt-[10px]",children:l[Object.keys(l)[0]]})]},p))})]})};function U(n){n<0&&(n=0);let t=n/1e3;const a=Math.floor(t/3600);t=t%3600;const r=Math.floor(t/60);t=t%60;const o=t.toFixed(0).padStart(2,"0"),c=r.toString().padStart(2,"0");return a===0?`${c} : ${o}`:`${a.toString().padStart(2,"0")}:${c}:${o}`}const Z=s.forwardRef(function(t,a){return e(I,{direction:"up",ref:a,...t})});M(B)({position:"absolute",right:"16px",top:"4px"});function ee({open:n,onCloseDialogSuccessTest:t,result:a,onSubmit:r,onOpenPreviewMode:o}){const c=()=>{r()};return e(_,{children:e(z,{fullWidth:!0,disableEscapeKeyDown:!0,onClose:(u,l)=>{l!=="backdropClick"&&t(u,l)},open:n,TransitionComponent:Z,keepMounted:!0,"aria-describedby":"alert-dialog-slide-description",children:m(F,{children:[e("p",{className:"text-center text-sm md:text-lg uppercase",children:"Cảm ơn bạn đã làm bài kiểm tra!"}),e("img",{src:"/thanks.png",alt:"img"}),m("p",{className:"text-center text-sm md:text-lg text-green-700",children:["Chúc mừng bạn đã hoàn thành bài thi với ",m("span",{className:"font-bold",children:[a.choicedTrue,"/",a.allQuestion]})," câu trả lời đúng trong khoảng thời gian ",U(a.time)]}),m("div",{className:"md:flex-row md:items-center md:justify-center md:space-x-2 flex flex-col justify-center items-center",children:[e("div",{children:e(w,{color:"error",variant:"contained",type:"submit",size:"small",style:{margin:"4px auto"},onClick:c,children:e("span",{children:"Kết thúc"})})}),e("div",{children:e(w,{color:"warning",variant:"contained",type:"submit",size:"small",style:{margin:"4px auto"},onClick:o,children:e("span",{children:"Xem lại bài thi"})})})]})]})})})}s.forwardRef(function(t,a){return e(I,{direction:"up",ref:a,...t})});M(B)({position:"absolute",right:"16px",top:"4px"});const le=()=>{const[n,t]=s.useState(null),[a,r]=s.useState(!1),o=()=>{r(!1)},[c,u]=s.useState(!1),l=()=>{u(!1)},p=()=>{u(!0)},v=J(),{enqueueSnackbar:N}=L(),[x,te]=s.useState(()=>JSON.parse(localStorage.getItem("thongtinthisinh"))),[S,k]=s.useState([]),[g,ne]=s.useState(()=>JSON.parse(localStorage.getItem("thongtinbaithi")));s.useState(!1);const[E,se]=s.useState(!1),[C,H]=s.useState({choicedTrue:0,allQuestion:0,time:0}),[$,P]=s.useState(!1),[q,T]=s.useState(!1);s.useEffect(()=>{let i=JSON.parse(localStorage.getItem("question_list"));if(!i)return;let h=[];i.forEach(f=>{let b=[];f.options_sort.forEach(d=>b=[...b,{[d]:f.questionlist[d]}]);const y=b.map(d=>Object.fromEntries(Object.entries(d).filter(([ae,Y])=>Y!==""))).filter(d=>Object.keys(d).length>0);h.push({question:f.questionlist.question,image:f.questionlist.image,choice:f.questionlist.choice,_id:f.questionlist._id,options:y})}),k(h)},[]),s.useEffect(()=>{(!x||!S||!g)&&v("/tracnghiem"),(async()=>{try{let h=await D.checkedTest(g._id);t(h.data.timeNow)}catch{v("/tracnghiem")}})()},[]);const R=(i,h)=>{let f=S.map(d=>d._id.toString()===i?{...d,choice:h}:d),b=JSON.parse(localStorage.getItem("question_list")),y=b.find(d=>d.questionlist._id===i);y.questionlist.choice=h,localStorage.setItem("question_list",JSON.stringify(b)),k(f)},O=async()=>{try{T(!0);let i=await D.submitTest(g._id,S);H({...C,choicedTrue:i.data.choicedTrue,allQuestion:i.data.allQuestion,time:i.data.timeTest}),T(!1),P(!0),r(!0)}catch(i){console.log(i),N(i.message,{anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"error"})}},Q=()=>{localStorage.removeItem("thongtinthisinh"),localStorage.removeItem("question_list"),localStorage.removeItem("thongtinbaithi"),r(!1),v("/tracnghiem")};return e("div",{children:m("div",{className:"flex-1",children:[e("div",{className:"shadow-md shadow-slate-400 h-[150px] md:h-auto bg-center py-2 bg-cover sticky top-0 bg-[url('/banner.jpg')] md:bg-[url('/bannerdesktop.png')] z-10 flex justify-center",children:m("div",{className:"",children:[e("div",{className:"flex justify-center",children:e("img",{src:"/cong-an-hieu.png",className:"md:w-28 w-12"})}),e("h3",{className:"text-center text-[11px] md:text-lg uppercase text-[#ab0000] font-bold",children:"Công an tỉnh Hưng Yên"}),e("h3",{className:"text-center text-[11px] md:text-lg uppercase text-[#ab0000] font-bold",children:"Phòng cảnh sát giao thông"}),e("div",{className:"text-center",children:e(X,{timeNow:n,stop:$,onHandleSubmitTest:O,thoigianketthuc:g==null?void 0:g.thoigianketthuc})})]})}),e("h3",{className:"text-center text-sm mt-4 md:text-[18px] text-[#ab0000] font-bold",children:x==null?void 0:x.tencuocthi}),m("p",{className:"text-center font-semibold text-[12px] md:text-[18px]",children:["Ngày tổ chức:"," ",K(x==null?void 0:x.ngaytochucthi).format("DD/MM/YYYY")]}),e("div",{className:"fixed md:hidden inset-0 bottom-[-100px] flex items-center justify-center pointer-events-none z-0",children:e("img",{src:"/logoc08.png",className:"opacity-20 h-[40vh] md:h-[60vh] object-contain",alt:""})}),e("div",{className:"md:px-12 mt-2 py-1 md:mx-10 px-2 shadow-sm shadow-slate-700",children:S==null?void 0:S.map((i,h)=>e(G,{question:i,index:h+1,onHandleChangeChoice:R},i._id))}),e("div",{className:"flex items-center justify-center my-2 mb-24",children:e(w,{variant:"contained",onClick:()=>O(),children:"Nộp bài thi"})}),m("div",{className:"px-2 bg-[url('/nentrongdong.png')] bg-cover bg-center mt-4 fixed bottom-0 w-full py-1",children:[e("p",{className:"text-center font-semibold text-[12px] text-[#ab0000] md:text-[16px] ",children:"Bản quyền thuộc về Phòng Cảnh sát giao thông"}),e("p",{className:"text-center font-semibold text-[12px] text-[#ab0000] md:text-[16px]",children:"Ứng dụng công nghệ thông tin trong tuyên truyền pháp luật"}),e("p",{className:"text-center font-semibold text-[#ab0000] text-[12px] md:text-[16px]",children:"@2026 - Cuộc thi tìm hiểu Luật trật tự, an toàn giao thông đường bộ dành cho Học sinh tỉnh Hưng Yên"})]}),E&&e(j,{}),e(ee,{open:a,onCloseDialogSuccessTest:o,result:C,onSubmit:Q,onOpenPreviewMode:p}),e(V,{open:c,onCloseDialogPreviewBaithi:l,idBaithi:g==null?void 0:g._id}),e(j,{open:q})]})})};export{le as default};
